<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <title>
      packages/dnsmasq – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../TracGuide.html" />
        <link rel="alternate" href="dnsmasq%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../packages.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="https://www.google.com/search" method="get" onsubmit="; this.elements.namedItem('q').value = this.elements.namedItem('oq').value + ' site:freetz.github.io'">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="oq" size="18" value="" />
          <input type="hidden" name="q" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><li class="last"><a href="../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="https://github.com/Freetz/freetz/commits/master">Quellen durchsehen</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="dnsmasq.html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="/wiki/packages/dnsmasq.en" title="(not available)">English</a></li></ul></div><p /><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="dnsmasq.html" title="Zeige packages/dnsmasq an">dnsmasq</a>
</div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">

          <div id="wikipage" class="trac-content"><p>
</p><div class="wiki-toc"><h4>Inhaltsverzeichnis</h4><ol><li><a href="dnsmasq.html#Installation">Installation</a></li><li><a href="dnsmasq.html#Konfiguration">Konfiguration</a></li><li><a href="dnsmasq.html#DNSServer">DNS Server</a><ol><li><a href="dnsmasq.html#mitiptablesdenDNS-Portumleiten">mit iptables den DNS-Port umleiten</a></li></ol></li><li><a href="dnsmasq.html#Kommandozeilen-Optionen">Kommandozeilen-Optionen</a><ol><li><a href="dnsmasq.html#Beispiel1">Beispiel 1</a></li><li><a href="dnsmasq.html#Beispiel2">Beispiel 2</a></li></ol></li><li><a href="dnsmasq.html#DHCPServer">DHCP Server</a><ol><li><a href="dnsmasq.html#Beispiel">Beispiel</a></li></ol></li><li><a href="dnsmasq.html#EinträgeinderHosts-Liste">Einträge in der Hosts-Liste</a></li><li><a href="dnsmasq.html#DHCPBoot">DHCP Boot</a></li><li><a href="dnsmasq.html#TFTPServer">TFTP Server</a><ol><li><a href="dnsmasq.html#Beispiel3">Beispiel</a></li></ol></li><li><a href="dnsmasq.html#KompletteigeneKonfiguration">Komplett eigene Konfiguration</a></li><li><a href="dnsmasq.html#WeiterführendeLinks">Weiterführende Links</a></li></ol></div><p>
</p>
<h1 id="dnsmasq">dnsmasq</h1>
<p>
<span class="thumbnail-right"><span class="aux" style="width: 402px;"><a style="border-width: 1px;" href="/screenshots/200?format=raw" title="Konfiguration"><img src="/screenshots/200?width=400&amp;format=raw&amp;height=400" alt="Konfiguration" /></a><span class="description" style="width: 402px;"><a href="/screenshots/200" title="Konfiguration">Dnsmasq Konfiguration</a></span></span></span>
Dnsmasq ermöglicht es, auf der FRITZBox
</p>
<ul><li>einen <strong>DNS-Server</strong>, der die IP- und Namensauflösung zentral vornimmt,
</li><li>einen <strong>DHCP-Server</strong>, der Clienten eine IP-Adresse und einen Hostnamen übermittelt, und
</li><li>einen <strong>TFTP-Server</strong>, der z. B. das Booten via <a class="ext-link" href="http://de.wikipedia.org/wiki/Preboot_Execution_Environment"><span class="icon">​</span>PXE</a> ermöglicht,
</li></ul><p>
zu betreiben.
</p>
<p>
Dnsmasq läuft komplett auf der FRITZBox, man braucht also keine gesonderten Rechner als DHCP-Server und als DNS-Server.
</p>
<p>
Das Besondere ist, dass dnsmasq statische DHCP-Leases beherrscht, was die FRITZBox ohne Freetz nur eingeschränkt kann. So ist es jetzt möglich einem Client eine selbst definierte feste IP zu geben und nicht nur eine bereits durch den DHCP vergebene IP fest mit dem Client zu verbinden.
</p>
<h2 id="Installation">Installation</h2>
<p>
Dnsmasq ist als Paket im Rahmen von Freetz realisiert und kann bei dessen Erzeugung einfach ausgewählt werden.
</p>
<h2 id="Konfiguration">Konfiguration</h2>
<p>
Zur Konfiguration gibt es im Web-Interface von Freetz die Seiten:
</p>
<ul><li><em>Pakete / Dnsmasq</em>: Optionen zum Startverhalten, DNS-Server und DHCP-Server (DHCP-Ranges)
</li><li><em>Einstellungen / Hosts</em>: Liste fest vorgegebener Hostnamen
</li><li><em>Einstellungen / Dnsmasq: extra</em>: Textfeld zur Eingabe zusätzlicher Optionen (dnsmasq long options ohne führende <tt>--</tt>)
</li></ul><p>
<img src="../../chrome/wikiextras-icons-16/exclamation.png" style="vertical-align: text-bottom" alt="/!\" /> Wenn der DHCP-Server von dnsmasq genutzt werden soll, dann ist der FRITZBox-interne DHCP-Server aus der Original-Firmware unter <em>System</em> &rarr; <em>Netzwerkeinstellungen</em> &rarr; <em>IP-Adressen</em> zu <span class="underline">deaktivieren</span>
</p>
<h2 id="DNSServer">DNS Server</h2>
<p>
Im Abschnitt <em>Der DNS Server ist gebunden an: Port:</em> trägt man den Port ein, an den der DNS-Server gebunden ist. Der Default-Wert ist hier Port 53.
</p>
<p>
Im Feld <em>Domain</em> kann die Domain (Domain-Teil des Hostnamens) für den DHCP-Server angegeben werden.
</p>
<p>
Das hat zwei Effekte. Erstens veranlasst es den DHCP-Server, diese Domain an Hosts zurückzugeben, die sie anfordern. Zweitens bestimmt es die Domain, die legitimiert ist, von DHCP-konfigurierten Hosts angefordert zu werden.
</p>
<p>
Dahinter steckt die Absicht, einen Hostnamen zu erzwingen, so kann ein nicht vertrauenswürdiger Host im LAN seinen Namen über DHCP z. B nicht als "ip-phone-forum.de" angeben.
</p>
<p>
Wenn unter <em>Domain</em> nichts angegeben wurde, wird jeder DHCP-Hostname, der einen Domain-Teil enthält, zurückgewiesen. Wenn jedoch im Feld <em>Domain</em> ein Name angegeben wurde, dann sind Hostnamen, die einen Domain-Teil enthalten, erlaubt, vorausgesetzt, dieser Domain-Teil und der Name im Feld <em>Domain</em> stimmen überein.
</p>
<p>
Wenn ein Name unter <em>Domain</em> angegeben wurde und somit Hostnamen ohne Domain-Teil erlaubt sind, kann außerdem der Name im <em>Domain</em>-Feld als optionaler Domain-Teil hinzugefügt werden.
</p>
<p>
Wenn man z. B. im Feld <em>Domain</em> "fritz.box" einträgt und außerdem ein Rechner mit dem DHCP-Hostnamen "Laptop" vorhanden ist, dann ist mit dnsmasq die IP-Adresse dieses Rechners sowohl als "Laptop" als auch als "laptop.fritz.box" verfügbar.
</p>
<p>
Gibt man die Domain als "<strong>#</strong>" an, dann wird die Domain von der ersten "search"-Direktive in <tt>/etc/resolv.conf</tt> gelesen.
</p>
<p>
<em>Anmerkung 1:</em> Diese Funktion entspricht den dnsmasq-Parametern <tt>-E -s &lt;domainname&gt;</tt>
</p>
<p>
<em>Anmerkung 2:</em> Achtung, die bereits in <a class="ext-link" href="http://www.freebsd.org/doc/de/books/handbook/configtuning-configfiles.html"><span class="icon">​</span>resolv.conf</a> bestehenden Einträge<br />
<tt>nameserver 192.168.x.x</tt> oder auch <tt>nameserver 127.0.0.1</tt><br />
kommen von AVM und dürfen nicht gelöscht werden, sonst funktioniert die Namensauflösung von AVM (z.B. Internettelefonie) nicht mehr (egal, ob die Box per DSL oder hinter einem Kabelmodem am Internet hängt). Gegebenfalls sind aber die Adressen (z.B. per Telnet) auf den oder die jetztigen DNS Server zu setzen.
</p>
<h3 id="mitiptablesdenDNS-Portumleiten">mit iptables den DNS-Port umleiten</h3>
<p>
Dazu den Port von dnsmasq auf 50053 ändern und die Optionen 'vor multid starten' und 'multid restarten' deaktivieren. <br />
Im menuconfig müssen diese Optionen von iptables ausgewählt sein (<img src="../../chrome/wikiextras-icons-16/exclamation.png" style="vertical-align: text-bottom" alt="/!\" /> je nach Kernelversion variieren die Namen etwas): <br />
</p>
<p>
bei Kernel 2.6.28 (zb Fritzbox 7320):
</p>
<pre class="wiki">nf_conntrack nf_conntrack_ipv4 nf_defrag_ipv4 iptable_filter iptable_nat ip_tables ipt_REDIRECT
x_tables xt_tcpudp
libipt_REDIRECT
libxt_standard libxt_tcp libxt_udp
</pre><p>
Die Module durch eintragen in 'modules' beim Start von Freetz laden.
</p>
<p>
Diese iptables Regeln mittels rc.custom ausführen:
</p>
<pre class="wiki">rport=50053

iptables -t nat -F dns 2&gt;/dev/null
iptables -t nat -N dns

iptables -t nat -D PREROUTING -p tcp --dport 53 -j dns 2&gt;/dev/null
iptables -t nat -I PREROUTING -p tcp --dport 53 -j dns
iptables -t nat -D PREROUTING -p udp --dport 53 -j dns 2&gt;/dev/null
iptables -t nat -I PREROUTING -p udp --dport 53 -j dns

iptables -t nat -D OUTPUT -o lo -p tcp --dport 53 -j REDIRECT --to-port $rport 2&gt;/dev/null
iptables -t nat -I OUTPUT -o lo -p tcp --dport 53 -j REDIRECT --to-port $rport
iptables -t nat -D OUTPUT -o lo -p udp --dport 53 -j REDIRECT --to-port $rport 2&gt;/dev/null
iptables -t nat -I OUTPUT -o lo -p udp --dport 53 -j REDIRECT --to-port $rport

for _if in $(ifconfig | sed -nr 's/^([^ ]*) .*/\1/p' | grep -vE "lo|dsl|:|eth"); do
_ip="$(ifconfig $_if 2&gt;/dev/null | sed -n 's/.*inet addr:\([0-9\.]*\).*/\1/p')"
[ -z "$_ip" ] &amp;&amp; continue
iptables -t nat -I dns -i $_if -p tcp -d $_ip -j REDIRECT --to-port $rport
iptables -t nat -I dns -i $_if -p udp -d $_ip -j REDIRECT --to-port $rport
done
</pre><p>
So kann der multid Port 53 belegen, aber es wird trotzdem dnsmasq zur Namensauflösung genutzt. Außerdem sind so Restarts von multid nicht mehr nötig.
</p>
<h2 id="Kommandozeilen-Optionen">Kommandozeilen-Optionen</h2>
<p>
Unter <em>Zusätzliche Kommandozeilen-Optionen (für Experten)</em> lassen sich weitere dnsmasq-Optionen eintragen. Einige dieser Optionen sind in den folgenden Beispielen erläutert. Alle Parameter finden sich auf der <a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html"><span class="icon">​</span>originalen Man-Page von dnsmasq</a>. Alle Optionen können anstelle der Kommandozeilen-Option auch unter <em>Einstellungen</em> &rarr; <em>Dnsmasq-extra</em> als Liste eingetragen werden (dann das führende Zeichen <tt>-</tt> weglassen). Das ist wesentlich bequemer und man kann auch mit # Kommentare zufügen. Eine  Beispiel-Konfiguration findet man hier:<a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq.conf.example"><span class="icon">​</span>dnsmasq.conf.example</a>.<br />
Nach Speichern der Änderungen wird dnsmasq automatisch neu gestartet, damit die Änderungen wirksam werden. (Ansonsten manuell über <em>Dienste</em> &rarr; <em>dnsmasq restart</em>)
</p>
<h3 id="Beispiel1">Beispiel 1</h3>
<p>
Durch (Kommandozeilen-Optionen)
</p>
<pre class="wiki">-O 44,192.168.178.1 -O 45,192.168.178.1 -O 46,8
</pre><p>
oder alternativ (als Liste)
</p>
<pre class="wiki">#options to DHCP clients
dhcp-option=44,192.168.178.1
dhcp-option=45,192.168.178.1
dhcp-option=46,8
</pre><p>
wird unter der Adresse 192.168.178.1 ein WINS- und ein NBDD-Server mit dem NetBIOS-Knotentyp "h-Knoten" beim Client eingetragen.<br /> <em>-O</em> bezeichnet spezielle Optionen für DHCP-Clients, hier für NetBIOS über TCP/IP; dem Code <em>44</em> folgt die IP-Adresse für WINS-Server, <em>45</em> die für NBDD-Server, und <em>46</em> der Knotentyp.
</p>
<p>
Die meisten DHCP-Optionen sind in der <a class="ext-link" href="http://www.faqs.org/rfcs/rfc2132.html"><span class="icon">​</span>RFC2132</a> festgelegt. Allgemeine Informationen zu DHCP in deutscher Sprache findet man bei <a class="ext-link" href="http://technet.microsoft.com/de-de/library/cc778368%28WS.10%29.aspx"><span class="icon">​</span>Microsoft DHCP</a>.
</p>
<h3 id="Beispiel2">Beispiel 2</h3>
<p>
Durch (Kommandozeilen-Optionen)
</p>
<pre class="wiki">-R -S 208.67.222.222 -S 208.67.220.220
</pre><p>
oder alternativ (als Liste)
</p>
<pre class="wiki">#don't read resolv file
no-resolv
#dns server
server=208.67.222.222
server=208.67.222.220
</pre><p>
werden eigene DNS-Einträge genutzt, im Beispiel diejenigen von <a class="ext-link" href="http://www.opendns.com/"><span class="icon">​</span>www.OpenDNS.com</a>. <em>-S</em> nutzt den DNS mit der angegebenen IP-Adresse. Dieser Schalter unterdrückt nicht das Lesen der Datei <tt>resolv.conf</tt>, das muss zusätzlich mit <em>-R</em> erledigt werden.
</p>
<h2 id="DHCPServer">DHCP Server</h2>
<p>
Im Bereich <em>DHCP Range (eine pro Zeile)</em> werden die Bereiche in folgender Form eingetragen:
</p>
<pre class="wiki">[[net:]network-id,]&lt;start-addr&gt;,&lt;end-addr&gt;[[,&lt;netmask&gt;],&lt;broadcast&gt;][,&lt;default lease time&gt;]
</pre><p>
(Die <a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html"><span class="icon">​</span>dnsmask Direktive</a> dazu lautet: <tt>dhcp-range</tt>. Man findet findet übrigens fast alle gespeicherten Einstellungen im File: <tt>/mod/etc/dnsmasq.conf</tt>)
</p>
<p>
Dabei werden Adressen aus dem Bereich von &lt;start-addr&gt; bis &lt;end-addr&gt; zuzüglich der statisch definierten Adressen aus den <strong>Einträgen in der Hosts-Liste</strong> vergeben.
</p>
<p>
Wenn eine Lease-Time ("Leihzeit") angegeben wird, dann werden Leases für diese Zeitspanne vergeben. Die Lease-Time kann in Sekunden (z. B. <strong>30</strong>) oder Minuten (z. B. <strong>45m</strong>) oder Stunden (z. B. <strong>1h</strong>) oder durch das Wort <strong>infinite</strong> (unendlich) angegeben werden. Diese Option kann mit unterschiedlichen Adressen wiederholt werden, um den DHCP-Service zu mehr als einem Netz zu ermöglichen.
</p>
<p>
Eine Liste der vergebenen Leases findet man in den Files <tt>/var/tmp/dnsmasq.leases</tt> und <tt>/var/tmp/multid.leases</tt>. Sollte man mal 'komische' Zuordnungen von Leases oder IP-Adressen in Netz feststellen, lohnt sich ein Blick auf diese Files allemal. Mit Telnet kann man diese notfalls auch komplett löschen. Mit einen Neustart von dnsmasq werden die Files automatisch neu erstellt.
</p>
<p>
Für direkt verbundene Netze (d. h. Netze, zu denen die FRITZBox mit laufendem dnsmasq eine Schnittstelle hat) ist netmask optional. Es wird jedoch für Netze verlangt, die den DHCP-Service über einen Relay-Agenten empfangen.
</p>
<p>
Die Broadcast-Adresse ist immer optional. Die optional freigestellte Network-ID ist ein alphanumerisches Label, das dieses Netz kennzeichnet, damit DHCP-Optionen auf einer Per-Netzwerk-Basis spezifiziert werden können. Wenn <em>net:</em> davor gesetzt wird, ändert sie ihre Bedeutung von Setzen eines Tag zu Matching. Nur ein Tag kann gesetzt werden, mehr als ein Tag können jedoch gematchet werden. Die Endadresse kann durch das Schlüsselwort <em>static</em> ersetzt werden, das weist dnsmasq an, DHCP für das spezifizierte Netz zu ermöglichen, aber IP-Adressen nicht dynamisch zuzuteilen. Nur Hosts, die statisch vergebene Adressen entsprechend der <em>Einträge in der Hosts-Liste</em> haben, werden bedient.
</p>
<h3 id="Beispiel">Beispiel</h3>
<p>
Mit dem Eintrag
</p>
<pre class="wiki">192.168.178.20,192.168.178.200,12h
</pre><p>
werden Adressen von IP 192.168.178.20 bis IP 192.168.178.200 mit einer Lease-Time von 12 Stunden vergeben.
</p>
<h2 id="EinträgeinderHosts-Liste">Einträge in der Hosts-Liste</h2>
<pre class="wiki">&lt;ipaddr&gt;|* &lt;hwaddr&gt;|[id:]&lt;client_id&gt;|* [net:]&lt;netid&gt;|* &lt;hostname&gt;|* [ignore]
</pre><p>
Die Einträge in der Liste fest vorgegebener Hostnamen erlauben, dass einem Rechner mit einer bestimmten Hardwareadresse immer die gleichen Hostname, IP-Adresse, Lease-Time zugeteilt werden können. Ein hier spezifizierter Hostname wird über den DHCP-Client auf den Rechner geliefert. Hier statisch vergebene IP-Adressen werden logischerweise bei der dynamischen IP-Vergabe ausgespart.
</p>
<p>
Hostnamen <span class="underline">mit Punkten im Namen</span> sind ab Release 1.6 (dnsnasq 2.40) <span class="underline">nicht mehr zulässig</span>! Dies quittiert dnsmasq mit der Fehlermeldung
</p>
<pre class="wiki">fritz daemon.err dnsmasq[ ]: bad name at /etc/ethers line ...
</pre><p>
Eine Zuordnung aus der Hosts-Liste ist dann nicht mehr möglich, und es werden einfach andere Adressen zugeordnet.
</p>
<p>
Es ist auch zulässig, die Hardwareadresse auszulassen und dafür den Hostnamen mit anzugeben, in diesem Fall treffen IP-Adresse und Lease-Time auf jeden möglichen Rechner zu, der diesen Hostnamen liefert. Z. B. weist <tt>00:20:e0:3b:13:af wap infinite</tt> dnsmasq an, dem Rechner mit der Hardwareadresse <tt>00:20:e0:3b:13:af</tt> den Namen wap und eine unendliche DHCP-Lease-Time zuzuteilen.
</p>
<p>
<tt>lap 192.168.0.199</tt> weist dnsmasq an, dem Rechner lap immer die IP-Adresse 192.168.0.199 zuzuteilen. Die Adressen, die so zugeteilt werden, werden nicht auf den durch die dhcp-range-Option angegebenen Bereich begrenzt, aber sie müssen im Netz, das durch den DHCP-Server bedient wird, vorhanden sein.
</p>
<p>
Um Hosts zu kennzeichnen, kann man statt der Hardwareadresse auch die Client-ID verwenden, indem man <tt>id:</tt> vorsetzt. So bezieht sich <tt>id:01:02:03:04 .....</tt> auf den Host mit Client-ID !01:02:03:04. Man kann auch die Client-ID als Text spezifizieren: <tt>id:clientidastext .....</tt> Die spezielle Option <tt>id:*</tt> bedeutet alle möglichen Client-IDs ignorieren und ausschließliche Nutzung der Hardwareadressen. Dies ist nützlich, wenn ein Client meistens eine feste Client-ID hat, manchmal aber eine andere.
</p>
<p>
Nur wenn ein Eintrag in der Hosts-Liste mit dem entsprechenden Namen vorhanden ist, kann die zugehörige IP-Adresse über einen DHCP-Lease zugeteilt werden.
</p>
<p>
Das spezielle Schlüsselwort <tt>ignore</tt> weist dnsmasq an, einem Rechner nie einen DHCP-Lease anzubieten. Dieser Rechner kann durch seine Hardwareadresse, Client-ID oder Hostnamen, zum Beispiel <tt>00:20:e0:3b:13:af ignore</tt> spezifiziert werden. Dies ist nützlich, wenn es einen anderen DHCP-Server im Netz gibt, der von einigen Rechnern benutzt werden soll.
</p>
<p>
Die Option <tt>net:&lt;network-id&gt;</tt> setzt das Netzwerk-ID-Tag, wenn diese DHCP-Host-Richtlinie genutzt wird. Das kann verwendet werden, um DHCP-Optionen für diesen Host selektiv zu senden. Ethernet-Adressen (aber nicht Client-IDs) können Wildcard-Bytes wie etwa <tt>00:20:e0:3b:13:* ignore</tt> enthalten. Das veranlasst dnsmasq, eine Range der Hardwareadressen zu ignorieren.
</p>
<p>
Hardwareadressen können normalerweise irgendeinen Netz(ARP)-Typ aufweisen, aber es ist auch möglich, sie auf einzelne ARP-Typen einzuschränken, indem man ihnen den ARP-Typ (in HEX) und - voranstellt. So bezeichnet <tt>06-00:20:e0:3b:13:af 1.2.3.4</tt> nur eine Token-Ring-Hardware-Adresse, da die ARP-Adresse für Token Ring 6 ist.
</p>
<p>
<em>Anmerkung:</em> Die <tt>/etc/hosts</tt> ist ein Symlink auf <tt>/var/tmp/hosts</tt>. Diese wiederum wird aus <tt>hosts</tt> mit den MAC-Adressen etc. beim Start von dnsmasq generiert.
</p>
<h2 id="DHCPBoot">DHCP Boot</h2>
<p>
Der DHCP-Boot-Eintrag wird für Optionen des <a class="ext-link" href="http://de.wikipedia.org/wiki/Bootstrap_Protocol"><span class="icon">​</span>BOOTP</a>-Protokolls gebraucht. Zusammen mit dem TFTP-Server können damit datenträgerlose Arbeitsstationen konfiguriert werden.
</p>
<p>
(Die <a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html"><span class="icon">​</span>dnsmask Direktive</a> dazu lautet: <tt>dhcp-boot</tt>. )
</p>
<h2 id="TFTPServer">TFTP Server</h2>
<p>
Für einen TFTP-Server lauten die <a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html"><span class="icon">​</span>dnsmask Direktiven</a>: <tt>enable-tftp</tt> und <tt>tftp-root</tt>.
</p>
<h3 id="Beispiel3">Beispiel</h3>
<p>
Der integrierte TFTP-Server für einen Zugriff auf die Daten unter <tt>/var/ftpd</tt> wird wie folgt aktiviert:
</p>
<pre class="wiki">--enable-tftp --tftp-root=/var/ftpd
</pre><p>
Man sollte also zusätzlich zum Parameter <tt>--enable-tftp</tt> (der den integrierten TFTP-Server aktiviert) mittels <tt>--tftp-root=/irgendein_pfad_auf_der_box</tt> angeben, wo die Dateien liegen, auf die per TFTP zugegriffen werden darf. Soll ein Client-Rechner via BOOTP (Bootstrap Protocol &mdash; die erweiterte automatische Methode per PXE [Preboot Execution Environment] ist hier nicht möglich) und TFTP gebootet werden, muss noch das entsprechende Bootimage definiert werden. Das geschieht mit folgendem Parameter:
</p>
<pre class="wiki">-M [net:&lt;network-id&gt;,]&lt;filename&gt;,[&lt;servername&gt;[,&lt;serveraddress&gt;]]
</pre><p>
Dieser setzt die durch den DHCP-Server zurückgegebenen BOOTP-Optionen. Dabei sind <em>Servername</em> und <em>Serveraddress</em> optional, ist hier nichts angegeben, wird der Name leer gelassen und die Adresse auf die Adresse der FRITZBox, auf der dnsmasq läuft, gesetzt. Für den von dnsmasq mit <tt>--enable-tftp</tt> zur Verfügung gestellten TFTP-Dienst ist hier nur der Dateiname erforderlich der das Booten ermöglicht. Sollten optionale Netzwerk-IDs angegeben werden, müssen diese mit der zu sendenden Konfiguration zusammenpassen und außerdem den Vorsatz <em>net:</em> aufweisen.
</p>
<p>
Nutzen kann man das Ganze zum Beispiel, um den Debian-Etch-Installer via Netzwerk zu booten. Dazu ist auf einem USB-Datenträger das Verzeichnis <tt>tftp</tt> zu erstellen und von einem Debian-Mirror die Datei <tt>netboot.tar.gz</tt> herunterzuladen (z. B. vom <a class="ext-link" href="http://ftp.tu-chemnitz.de/pub/linux/debian/debian/dists/etch/main/installer-i386/current/images/netboot/netboot.tar.gz"><span class="icon">​</span>Debian-Mirror der TU Chemnitz</a>) und in das soeben erstellte Verzeichnis zu entpacken. Ist der Datenträger mit NTFS oder FAT32 formatiert, muss der komplette Ordner <tt>debian-installer/i386/pxelinux.cfg</tt> und die Datei <tt>debian-installer/i386/pxelinux.0</tt> auf die gleiche Ebene wie <tt>debian-installer</tt> verschoben werden. Anschließend konfiguriert man dnsmasq wie folgt (Pfad eventuell noch anpassen, je nach Konfiguration beim Bauen von Freetz):
</p>
<pre class="wiki">--enable-tftp --tftp-root=/var/media/ftp/uStor01/tftp -M pxelinux.0
</pre><p>
Wenn der TFTP-Server auf einem anderen Rechner läuft, z. B. hier auf 192.168.178.10 mit dem Bootfile <tt>pxelinux.0</tt>, dann ist dieser anzugeben:
</p>
<pre class="wiki">-M pxelinux.0,192.168.178.10,192.168.178.10
</pre><h2 id="KompletteigeneKonfiguration">Komplett eigene Konfiguration</h2>
<p>
Es lassen sich auch komplett eigene Konfigurationen nutzen. Dazu erstellt man eine leere, ausführbare Datei mit dem Namen <em>/tmp/flash/dnsmasq_conf</em> und trägt dann im  Freetz-Web-Interface unter <em>Einstellungen</em> &rarr; <em>Dnsmasq: extra</em> die gewünschte Konfiguration ein. Informationen zur Syntax finden sich unter <a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq.conf.example"><span class="icon">​</span>Beispiel-Konfiguration</a>.
</p>
<h2 id="WeiterführendeLinks">Weiterführende Links</h2>
<ul><li><a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/doc.html"><span class="icon">​</span>Website von dnsmasq</a>
</li><li><a class="ext-link" href="http://www.martin-bock.de/pc/pc-0604.html"><span class="icon">​</span>Deutsche Beschreibung</a>
</li><li><a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq-man.html"><span class="icon">​</span>Man-Page</a>
</li><li><a class="ext-link" href="http://www.thekelleys.org.uk/dnsmasq/docs/dnsmasq.conf.example"><span class="icon">​</span>Beispiel-Konfiguration</a>
</li></ul></div>

      </div><ul class="tags"><li class="header">Tags</li><li><a href="/tags/network" rel="tag">network</a> </li><li><a href="../packages.html" rel="tag">packages</a> </li></ul>

    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/chrome/screenshots/css/screenshots.css", "text/css");
    </script>
    </div>
  </body>
</html>
