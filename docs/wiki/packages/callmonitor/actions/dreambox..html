<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      packages/callmonitor/actions/dreambox – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://freetz.org/search" />
        <link rel="help" href="../../../TracGuide.html" />
        <link rel="alternate" href="dreambox%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../actions.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="http://freetz.org/wiki" />
        <link rel="stylesheet" href="../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://freetz.org/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://freetz.org/wiki"><img src="../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="http://freetz.org/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://freetz.org/login">Anmelden</a></li><li><a href="http://freetz.org/prefs">Einstellungen</a></li><li><a href="../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="http://freetz.org/about">Über Trac</a></li><li><a href="http://freetz.org/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="http://freetz.org/register">Registrieren</a></li><li class="last"><a href="../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://freetz.org/wiki">Wiki</a></li><li><a href="http://freetz.org/timeline">Journal</a></li><li><a href="http://freetz.org/roadmap">Projektplan</a></li><li><a href="http://freetz.org/browser">Quellen durchsehen</a></li><li><a href="http://freetz.org/report">Tickets anzeigen</a></li><li><a href="http://freetz.org/search">Suche</a></li><li><a href="http://freetz.org/tags">Tags</a></li><li><a href="http://freetz.org/downloads">Downloads</a></li><li class="last"><a href="http://freetz.org/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="dreambox..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="http://freetz.org/wiki/packages/callmonitor/actions/dreambox.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="http://freetz.org/wiki">Wiki:</a><a class="pathentry" href="../../../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="../../callmonitor.html" title="Zeige packages/callmonitor an">callmonitor</a><span class="pathentry sep">/</span><a class="pathentry" href="../actions.html" title="Zeige packages/callmonitor/actions an">actions</a><span class="pathentry sep">/</span><a class="pathentry" href="dreambox.html" title="Zeige packages/callmonitor/actions/dreambox an">dreambox</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../actions.html">Aufwärts</a></li><li><a href="../../../WikiStart.html">Startseite</a></li><li><a href="../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="dreambox%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="http://freetz.org/notification/packages/callmonitor/actions/dreambox." title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><p>
</p><div class="wiki-toc"><h4>Inhaltsverzeichnis</h4><ol><li><a href="dreambox.html#DreamboxmitEnigma1">Dreambox mit Enigma 1</a><ol><li><a href="dreambox.html#StandByCheck">StandBy Check</a></li></ol></li><li><a href="dreambox.html#DreamBoxmitEnigma2">DreamBox mit Enigma 2</a></li></ol></div><p>
</p>
<h1 id="DreamBox">DreamBox</h1>
<h2 id="DreamboxmitEnigma1">Dreambox mit Enigma 1</h2>
<pre class="wiki">  dreammessage [user[:password]@]host[:port] ["Alternative Nachricht"]
</pre><p>
<span class="thumbnail-right"><span class="aux" style="width: 122px;"><a style="border-width: 1px;" href="http://freetz.org/screenshots/1?format=raw" title="CallMonitor: Dreambox Auth abschalten"><img src="http://freetz.org/screenshots/1?width=120&amp;format=raw&amp;height=111" alt="CallMonitor: Dreambox Auth abschalten" /></a><span class="description" style="width: 122px;"><a href="http://freetz.org/screenshots/1" title="CallMonitor: Dreambox Auth abschalten">CallMonitor: Dreambox Auth abschalten</a></span></span></span> Wie zu sehen ist, ist "host" (also Rechnername oder IP-Adresse) der einzige Pflichtparameter. Damit die Nachricht aber auch wirklich ankommt, muss die Authentifizierung berücksichtigt werden. Eine Lösung ist es, wie beigefügter Screenshot aufzeigt, das Abschalten der Nachrichten-Authentifizierung auf der Box selbst. Wer das nicht will, dem bleibt zur Zeit nur, <tt>user:password@</tt> vor den Host zu setzen - was dann allerdings bei den Listeners im Klartext angezeigt wird.
</p>
<p>
<tt>dreammessage</tt> kennt ein Standard-Nachrichten-Template, was normalerweise verwendet wird. Wer die Nachricht lieber selbst formatieren will, findet <a class="wiki" href="../listeners.html#Ereignis-InformationenfürAktionen">hier</a> eine Liste mit verwendbaren Platzhaltern für Telefonnummer, Zeilenumbrüche, usw.
</p>
<p>
Desweiteren gibt es drei Umgebungsvariablen, die das Verhalten von <tt>dreammessage</tt> beeinflussen. Sie sind hier in einem typischen Aufruf mit ihren Standardwerten gezeigt:
</p>
<pre class="wiki">  DREAM_TIMEOUT=10 DREAM_CAPTION="Telefonanruf" DREAM_ICON=1 dreammessage box1
</pre><h3 id="StandByCheck">StandBy Check</h3>
<p>
Befindet sich die zu benachrichtigende Dreambox im StandBy, werden die Nachrichten solange zwischengespeichert, bis sie wieder aus selbigem aufwacht. An und für sich ganz nett - nur wenn man sie gerade mal ein paar Tage nicht benutzt hat, und dann nach dem Anschalten erstmal hunderte von "verpassten" Anrufen zu sehen bekommt. Daher wäre es für manchen sicher praktisch, würden die Nachrichten nur dann (und zwar sofort) zugestellt, wenn die Dreambox sich zum Zeitpunkt des Anrufes <em>nicht</em> im StandBy befindet - während andernfalls die Benachrichtigung komplett unterbliebe.
</p>
<p>
Glücklicherweise ist das machbar (getestet mit DM600, DM 7000 und DM7020). Auf folgende Weise lässt sich nämlich der Status ermitteln:
</p>
<div class="code"><pre><span class="c"># keine Passwort-Authentifizierung aktiv:
</span><span class="nv">standby</span><span class="o">=</span><span class="sb">`</span>wget -O- <span class="s2">"http://dreambox/cgi-bin/status"</span> | awk <span class="s1">'/Standby/'</span> | sed -e <span class="s1">'s/&lt;[^&gt;]*&gt;//g'</span><span class="sb">`</span>
<span class="c"># mit Passwort-Authentifizierung:
</span><span class="nv">standby</span><span class="o">=</span><span class="sb">`</span>wget -O- --http-user<span class="o">=</span>root --http-passwd<span class="o">=</span>dreambox <span class="s2">"http://dreambox/cgi-bin/status"</span> | awk <span class="s1">'/Standby/'</span> | sed -e <span class="s1">'s/&lt;[^&gt;]*&gt;//g'</span><span class="sb">`</span>
</pre></div><p>
Je nachdem, ob das WebIF für Passwort-Authentifizierung konfiguriert ist oder nicht, kann man also die entsprechende Variante nutzen. Das busybox-wget unterstützt allerdings keine Authentifizierung. Daher muss beim Bauen von freetz das Paket 'wget' installiert werden. Die Variable <tt>$standby</tt> ist anschließend entweder mit <tt>STANDBY:ON</tt> oder <tt>STANDBY:OFF</tt> belegt. Für unsere Benachrichtigungs-Aktion können wir uns das wie folgt nutzbar machen:
</p>
<div class="code"><pre><span class="o">[</span> <span class="s2">"$(wget -O- "</span>http://dreambox/cgi-bin/status<span class="s2">" | awk '/Standby/' | sed -e 's/&lt;[^&gt;]*&gt;//g')"</span> <span class="o">=</span> <span class="s2">"Standby:OFF"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">DREAM_TIMEOUT</span><span class="o">=</span>10 dreammessage dreambox <span class="s2">"${SOURCE_DISP} ruft an.${LF}${SOURCE_NAME}"</span>
</pre></div><p>
wobei natürlich <em>dreambox</em> mit dem Hostnamen bzw. der IP-Adresse der Dreambox ersetzt, sowie ggf. die Passwort-Authentifizierung mit eingebaut werden muss.
</p>
<p>
<em>Quelle: <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=100706&amp;page=55"><span class="icon">​</span>IPPF Thread</a></em>
</p>
<h2 id="DreamBoxmitEnigma2">DreamBox mit Enigma 2</h2>
<pre class="wiki">  dream2message (default_dream2message)
</pre><p>
<tt>DREAM_TIMEOUT</tt> und <tt>DREAM_ICON</tt> werden auch hier unterstützt.
</p>
<p>
Beispiel für ein Popup das nur den Namen (sofern in der Callers vorhanden) und die Telefonnummer des Anrufers anzeigt:<br />
</p>
<pre class="wiki">in:request ^ ^ dream2message 192.168.178.25 "${SOURCE_NAME} ${SOURCE} ruft an."
</pre></div>
          
          <div class="trac-modifiedby">
            <span><a href="dreambox%3Faction=diff&amp;version=7.html" title="Version 7 von oliver">zuletzt geändert</a> <a class="timeline" href="http://freetz.org/timeline?from=2009-12-20T17%3A48%3A22Z&amp;precision=second" title="Siehe Journal am 20.12.2009 17:48:22">vor 8 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 20.12.2009 17:48:22</span>
          </div>
        
        
      </div>
      

    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/chrome/screenshots/css/screenshots.css", "text/css");
        jQuery.loadStyleSheet("/pygments/trac.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="dreambox%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="http://freetz.org/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="http://freetz.org/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>