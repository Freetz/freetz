<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      packages/rrdstats – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://freetz.org/search" />
        <link rel="help" href="../TracGuide.html" />
        <link rel="alternate" href="rrdstats%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../packages.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="http://freetz.org/wiki" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://freetz.org/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://freetz.org/wiki"><img src="../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="http://freetz.org/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://freetz.org/login">Anmelden</a></li><li><a href="http://freetz.org/prefs">Einstellungen</a></li><li><a href="../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="http://freetz.org/about">Über Trac</a></li><li><a href="http://freetz.org/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="http://freetz.org/register">Registrieren</a></li><li class="last"><a href="../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://freetz.org/wiki">Wiki</a></li><li><a href="http://freetz.org/timeline">Journal</a></li><li><a href="http://freetz.org/roadmap">Projektplan</a></li><li><a href="http://freetz.org/browser">Quellen durchsehen</a></li><li><a href="http://freetz.org/report">Tickets anzeigen</a></li><li><a href="http://freetz.org/search">Suche</a></li><li><a href="http://freetz.org/tags">Tags</a></li><li><a href="http://freetz.org/downloads">Downloads</a></li><li class="last"><a href="http://freetz.org/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="rrdstats..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="http://freetz.org/wiki/packages/rrdstats.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="http://freetz.org/wiki">Wiki:</a><a class="pathentry" href="../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="rrdstats.html" title="Zeige packages/rrdstats an">rrdstats</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../packages.html">Aufwärts</a></li><li><a href="../WikiStart.html">Startseite</a></li><li><a href="../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="rrdstats%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="http://freetz.org/notification/packages/rrdstats" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="RRDstats">RRDstats</h1>
<p>
<span class="thumbnail-right"><span class="aux" style="width: 242px;"><a style="border-width: 1px;" href="http://freetz.org/screenshots/229?format=raw" title="RRDstats screenshot"><img src="http://freetz.org/screenshots/229?width=240&amp;format=raw&amp;height=550" alt="RRDstats screenshot" /></a><span class="description" style="width: 242px;"><a href="http://freetz.org/screenshots/229" title="RRDstats screenshot">RRDstats screenshot</a></span></span></span> 
</p>
<h2 id="Einleitung">Einleitung</h2>
<p>
RRD steht für Round Robin Database und wurde für Linux und Windows unter der GNU-Lizenz von Tobias Oetiker entwickelt. Es ist ein sehr leistungsfähiges Werkzeug, um zeitbezogene Messdaten wie Temperatur, Festplattenauslastung, Netzwerkverkehr auf kompakte Art und Weise in einer Datenbank zu speichern und ansprechend zu visualisieren. Weitere Details sind hier im Wiki beim Paket <a class="wiki" href="rrdtool.html">RRDtool</a> nachzulesen. Um die Daten nachher graphisch darzustellen, wird rrdstats verwendet, worum es hier im Detail geht. Das Package <a class="wiki" href="digitemp.html">DigiTemp</a> wird zum Aufzeichen von Temperaturwerten benötigt.
</p>
<h2 id="VoraussetzungenundEinbauvonRRDstatsbeimFirmware-Bau">Voraussetzungen und Einbau von RRDstats beim Firmware-Bau</h2>
<p>
Im <tt>menuconfig</tt>:
</p>
<ul><li>Package selection / Web interface / RRDstats for RRDtool [selektiert automatisch auch RRDtool 1.2.30 unter "Package selection / Testing"]
</li><li><em>nur für DigiTemp:</em> Package selection / Testing / digitemp 3.0.6 / digitemp for ds9097 [mit den beiden anderen Optionen ging es (bei ao) nicht]
Ich (cuma) nutze "ds2490" mit dem "DS9490R". Hierbei sind keine zusätzlichen Module nötig.
</li><li><em>nur für DigiTemp:</em> Advanced options / Kernel modules / drivers / pl2303.ko [habe für einen anderen Adapter zusätzlich auch noch ftdi_sio.ko ausgewählt]
</li><li><em>nur für Kabelmodem:</em> Optional das Package "wget" installieren. Dadurch werden Ausfälle bei Nichterreichbarkeit des Kabelmodem vermieden, es ist aber ca 350 kB gross.
</li></ul><p>
Auf der Box:
</p>
<ul><li><em>nur für DigiTemp:</em> im Freetz-WebGUI unter "Einstellungen / Freetz:modules das bzw. die Kernel-Modul(e) untereinander eintragen (aber ohne "modprobe" o.ä.!)
</li></ul><pre class="wiki">pl2303
ftdi_sio
</pre><ul><li>im Freetz-Webif unter "RRDstats" weitere Einstellungen vornehmen
</li></ul><h2 id="Backup">Backup</h2>
<p>
Sinnvoll ist die Anpassung der Pfade, falls man regelmäßige Backups der Messdaten machen möchte, z.B.:
</p>
<pre class="wiki">Backup Verzeichnis: /var/media/ftp/uStor01/rrdstats/backup
</pre><p>
&hellip; und im Freetz-WebGUI bei den RRDstats-Einstellungen das automatisch Wiederherstellen von Backups beim Starten aktivieren
</p>
<p>
Wenn man die Backups nun regelmäßig mittels eines cronjobs durchführt, z.B. alle 20-30 Minuten, sind die Lücken in den Graphen bei entsprechend kurzen Box-Ausfallzeiten auch nicht zu groß. Im Freetz-WebGUI gibt man dazu unter "Einstellungen / Freetz: crontab" z.B. folgendes ein:
</p>
<pre class="wiki">00 * * * * /etc/init.d/rc.rrdstats backup
20 * * * * /etc/init.d/rc.rrdstats backup
40 * * * * /etc/init.d/rc.rrdstats backup
</pre><p>
Näheres zu crontab bitte im Internet nachlesen.
</p>
<h2 id="EinstellungenWebGUI">Einstellungen WebGUI</h2>
<p>
"Not lazy" bedeutet, dass die Graphen immer neu generiert werden, hingegen bedeutet "lazy", dass sie nur neu generiert werden, wenn sie veraltet sind. Die Einstellung "lazy" (bzw. das Abschalten von "not lazy") verringert die CPU-Last.
</p>
<p>
Vefügbare Netzwerkintrafaces auf der Box kann man so ermitteln: <tt>ifconfig |grep -v "^ "</tt>
</p>
<p>
<img src="../../chrome/wikiextras-icons-16/exclamation.png" style="vertical-align: text-bottom" alt="/!\" /> Das Unterdrücken der 85°C Fehlerwerte wirkt sich nur auf die .rrd Dateien aus, nicht auf die .cvs.
</p>
<p>
<em>Die anderen Einstellungen dürften selbsterklärend sein. Falls nicht, bitte im Forum nachfragen und bei neuen Erkenntnissen hier ergänzen.</em>
</p>
<h2 id="DigiTemp">DigiTemp</h2>
<p>
Die Initialisierung ist nur 1x pro Messfühler nötig. <br />
Danach muss der Dienst "RRDstats" manuell wieder im Freetz-Webif unter "Dienste" gestartet werden <br />
</p>
<p>
<span id="cable"></span>
</p>
<h2 id="Kabelmodem">Kabelmodem</h2>
<p>
<span class="thumbnail-right"><span class="aux" style="width: 272px;"><a style="border-width: 1px;" href="http://freetz.org/screenshots/253?format=raw" title="RRDstats Cisco EPC (S-N Ratio)"><img src="http://freetz.org/screenshots/253?width=270&amp;format=raw&amp;height=169" alt="RRDstats Cisco EPC (S-N Ratio)" /></a><span class="description" style="width: 272px;"><a href="http://freetz.org/screenshots/253" title="RRDstats Cisco EPC (S-N Ratio)">RRDstats Cisco EPC (S-N Ratio)</a></span></span></span> 
<span class="thumbnail-right"><span class="aux" style="width: 272px;"><a style="border-width: 1px;" href="http://freetz.org/screenshots/252?format=raw" title="RRDstats Cisco EPC (Signal)"><img src="http://freetz.org/screenshots/252?width=270&amp;format=raw&amp;height=169" alt="RRDstats Cisco EPC (Signal)" /></a><span class="description" style="width: 272px;"><a href="http://freetz.org/screenshots/252" title="RRDstats Cisco EPC (Signal)">RRDstats Cisco EPC (Signal)</a></span></span></span>
Es werden die Kabelmodems Thomson THG 520 und 540, Cisco EPC 3212 und Arris Touchstone TM sowie baugleiche unterstützt.
</p>
<h3 id="LoggenderKanäle">Loggen der Kanäle</h3>
<p>
Sollen mehr Kanäle geloggt werden als beim Erstellen der Datenbank eingestellt waren, ist es an einfachsten die epc_*.rrd zu löschen. <br /><br />
Bereits aufgezeichneten Daten weiterzuverwenden ist aufwändiger, da rrdtool keine Möglichkeit bietet nachträglich einen DS hinzuzufügen. Dazu:
</p>
<ul><li>Datensicherung!
</li><li>Die Daten exportieren: <tt>rrdtool dump epc_60.rrd dump.xml</tt>
</li><li>DS Spalten hinzufügen. Hier am Beispiel 1 Upstreamkanal auf 2 erweitern:<br />
1) Am Anfang der dump.xml vor den Zeilen
<pre class="wiki">&lt;ds&gt;
&lt;name&gt; up &lt;/name&gt;
</pre>dies hinzufügen
<pre class="wiki">&lt;name&gt; txfq2 &lt;/name&gt;
&lt;type&gt; GAUGE &lt;/type&gt;
&lt;minimal_heartbeat&gt; 600 &lt;/minimal_heartbeat&gt;
&lt;min&gt; 9.0000000000e+00 &lt;/min&gt;
&lt;max&gt; 9.9000000000e+01 &lt;/max&gt;

&lt;!-- PDP Status --&gt;
&lt;last_ds&gt; UNKN &lt;/last_ds&gt;
&lt;value&gt; NaN &lt;/value&gt;
&lt;unknown_sec&gt; 25 &lt;/unknown_sec&gt;
&lt;/ds&gt;

&lt;ds&gt;
&lt;name&gt; txdb2 &lt;/name&gt;
&lt;type&gt; GAUGE &lt;/type&gt;
&lt;minimal_heartbeat&gt; 600 &lt;/minimal_heartbeat&gt;
&lt;min&gt; 0.0000000000e+00 &lt;/min&gt;
&lt;max&gt; 9.9000000000e+01 &lt;/max&gt;

&lt;!-- PDP Status --&gt;
&lt;last_ds&gt; UNKN &lt;/last_ds&gt;
&lt;value&gt; NaN &lt;/value&gt;
&lt;unknown_sec&gt; 25 &lt;/unknown_sec&gt;
&lt;/ds&gt;
</pre>2) 12 Zeilen vor allen <tt>&lt;/cdp_prep&gt;</tt> Zeilen dies hinzufügen
<pre class="wiki">&lt;ds&gt;
&lt;primary_value&gt; 0.0000000000e+00 &lt;/primary_value&gt;
&lt;secondary_value&gt; 0.0000000000e+00 &lt;/secondary_value&gt;
&lt;value&gt; NaN &lt;/value&gt;
&lt;unknown_datapoints&gt; 0 &lt;/unknown_datapoints&gt;
&lt;/ds&gt;
&lt;ds&gt;
&lt;primary_value&gt; 0.0000000000e+00 &lt;/primary_value&gt;
&lt;secondary_value&gt; 0.0000000000e+00 &lt;/secondary_value&gt;
&lt;value&gt; NaN &lt;/value&gt;
&lt;unknown_datapoints&gt; 0 &lt;/unknown_datapoints&gt;
&lt;/ds&gt;
</pre>3) Nun noch alle Zeilen die mit <tt>&lt;/row&gt;</tt> enden zwischen das drittletzte und vorletzte <tt>&lt;v&gt; ... &lt;/v&gt;</tt> dies einfügen: <tt>&lt;v&gt; NaN &lt;/v&gt; &lt;v&gt; NaN &lt;/v&gt;</tt>. 
</li></ul><ul><li>Geänderte Datenbank erstellen: <tt>rrdtool restore dump.xml epc_60.rrd -f</tt>
</li></ul><p>
Viel Spass und Erfolg beim nachmachen <img src="../../chrome/wikiextras-icons-16/smiley.png" style="vertical-align: text-bottom" alt=":)" />
</p>
<p>
<span id="segment"></span>
</p>
<h2 id="Kabelsegment">Kabelsegment</h2>
<p>
<span class="thumbnail-right"><span class="aux" style="width: 272px;"><a style="border-width: 1px;" href="http://freetz.org/screenshots/257?format=raw" title="RRDstats Kabelsegment"><img src="http://freetz.org/screenshots/257?width=270&amp;format=raw&amp;height=169" alt="RRDstats Kabelsegment" /></a><span class="description" style="width: 272px;"><a href="http://freetz.org/screenshots/257" title="RRDstats Kabelsegment">RRDstats Kabelsegment</a></span></span></span> 
Hiermit kann die Auslastung des Segmentes von Kabelinternet aufzeichnet werden.
Es wird zusätzlich noch ein Treiber benötigt. Momentan gibt es nur ein Package für DVB-Sticks von <a class="wiki" href="sundtek.html">Sundtek</a>. Vorteil dieser ist, dass man kein v4l im Kernel benötigt.
</p>
<h3 id="Datenbanken">Datenbanken</h3>
<p>
Bis zu <a class="changeset" href="http://freetz.org/changeset/11010" title="RRDstats:
 * *create* DigiTemp &amp; Cabel Segement Load databeases for 2 ...">r11010</a> konnte mit einem Intervall von 60 Sekunden 146 Tage aufgezeichnet werden, mit 150 Sekunden 1 Jahr. Ab dieser Revision werden die Datenbanken von DigiTemp und RRDstats-Kabelsegment mit 2 Jahren bei 60 Sekunden *erstellt*. Damit wachsen die einzelnen Dateien von ~85kB auf ~150kB.
Existierende rrd-Datenbanken kann man so neue RRAs hinzufügen: <a class="wiki" href="digitemp.html#Datenbank">DigiTemp#Datenbank</a>
</p>
<h2 id="Dateiübersichtunvollständig">Dateiübersicht (unvollständig)</h2>
<p>
Folgende Dateien/Pfade sind an der Erstellung der Graphischen Auswertung beteiligt:
</p>
<ul><li><tt>/usr/lib/cgi-bin/rrdstats/stats.cgi</tt>: Diverses Feintuning kann man in der Datei vornehmen. Erstellt die png Graphen, aus den rrd Dateien. Es lassen sich z.B. slopes u.ä. hinzufügen. Ein paar Hinweise dazu gibt es in <a class="ext-link" href="http://www.ip-phone-forum.de/showpost.php?p=1250750&amp;postcount=44"><span class="icon">​</span>diesem IPPF-Thread</a>. Zum manuellen generieren der Graphen (z.B. durch cron) kann der neue Parameter "graph" von rc.rrdstats genutzt werden
</li></ul><ul><li><tt>/usr/bin/rrdstats</tt>: Dieses Shellskript dient dem einsammeln der anzuzeigenden Werte, erstellt csv Dateien und pflegt die neuen Werte in die Round Robin Database über <a class="wiki" href="rrdtool.html">RRDtool</a> ein.
</li></ul><h2 id="BUGS">BUGS</h2>
<p>
Manchmal kann es vorkommen, dass die Zähler / Graphiken für CPU, Memory etc. nicht mehr verfügbar sind. Im Persistenten Verzeichnis (Dienste - RRDStats) sind dann leere Dateien für den jeweiligen counter zu finden. Abhilfe schafft ein stoppen des Dienstes, löschen der leeren Dateien und erneutes starten des Dienstes. Dabei werden die fehlenden Dateien erneut korrekt angelegt und der Fehler ist weg. Verursacht wahrscheinlich durch eine fehlerhaftes Datum auf der Fritzbox (Jahr 2017-Problem).
</p>
<p>
Die Dateien können auf ihre Konsistenz mit <tt>rrdtool dump dateiname.rrd</tt> überprüft werden.
</p>
<h2 id="Links">Links</h2>
<p>
Entstanden aus diesem Thread im IPPF: <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=183491"><span class="icon">​</span>http://www.ip-phone-forum.de/showthread.php?t=183491</a>
</p>
</div>
          
          <div class="trac-modifiedby">
            <span><a href="rrdstats%3Faction=diff&amp;version=24.html" title="Version 24 von cuma">zuletzt geändert</a> <a class="timeline" href="http://freetz.org/timeline?from=2013-09-17T18%3A34%3A51Z&amp;precision=second" title="Siehe Journal am 17.09.2013 18:34:51">vor 4 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 17.09.2013 18:34:51</span>
          </div>
        
        
      </div><ul class="tags"><li class="header">Tags</li><li><a href="http://freetz.org/tags/monitoring" rel="tag">monitoring</a> </li><li><a href="../packages.html" rel="tag">packages</a> </li></ul>
      

    </div>
    <script type="text/javascript">
        jQuery.loadStyleSheet("/chrome/screenshots/css/screenshots.css", "text/css");
    </script>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="rrdstats%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="http://freetz.org/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="http://freetz.org/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>