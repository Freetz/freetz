<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

  <head>
    <title>
      packages/ndas.en – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../TracGuide.html" />
        <link rel="alternate" href="ndas.en%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../packages.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="https://www.google.com/search" method="get" onsubmit="; this.elements.namedItem('q').value = this.elements.namedItem('oq').value + ' site:freetz.github.io'">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="oq" size="18" value="" />
          <input type="hidden" name="q" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><li class="last"><a href="../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=""><a class="" href="ndas.html" title="">German</a></li><li class=" active last"><a class="selected" href="ndas.en.html" title="selected and displaying language">English</a></li></ul></div><p /><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../packages.html" title="Zeige packages an">packages</a><span class="pathentry sep">/</span><a class="pathentry" href="ndas.en.html" title="Zeige packages/ndas.en an">ndas.en</a>
</div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">

          <div id="wikipage" class="trac-content"><h2 id="NDAS">NDAS</h2>
<p>
NDAS (<strong>N</strong>etwork <strong>D</strong>irect <strong>A</strong>ttached <strong>S</strong>torage) is Ximeta's patented technology which enables all digital storage devices (HDD, ODD, Memory, Tape Drives) direct connection into standard Ethernet networks. <br />
All users or systems on the network can directly control, use and share those devices. <br />
More info about NDAS on Linux can be found via: <a class="ext-link" href="http://ndas4linux.iocellnetworks.com/"><span class="icon">​</span>http://ndas4linux.iocellnetworks.com/</a> <br />
I'm using NDAS currenlty to play movies up to 720p.
</p>
<h3 id="CreatingaFeetzImagewithNDAS">Creating a Feetz Image with NDAS</h3>
<p>
<strong>Note</strong> NDAS is now supported for little endian (e.g. 7170, 7270) and big endian (e.g. 7390) thanks to <a class="ext-link" href="http://www.ip-phone-forum.de/member.php?u=83184"><span class="icon">​</span>ER13</a>.<br />
The changes are introduced in <a href="/changeset/11390">11390</a> to <a href="/changeset/11392">11392</a>, <a href="/changeset/11434">11434</a>, and <a href="/changeset/11464">11464</a>.<br /><br />
Follow the directions from the <a href="../index.en.html#">Wiki</a> <br />
After the following step you can configure the packages you want to have included in your image.
</p>
<pre class="wiki">make menuconfig
</pre><p>
Make sure the following is selected:
</p>
<pre class="wiki">Package selection  ---&gt; Packages  ---&gt; [*] (binary only)
</pre><p>
Recommended optional additional packages:
</p>
<blockquote>
<p>
<a href="ntfs-3g.html">NTFS-3G</a> <br />
<a href="samba.html">Samba</a> <br />
</p>
</blockquote>
<p>
or(/and)
</p>
<blockquote>
<p>
<a href="nfsd.html">NFS Server</a> (no ntfs support, but a faster) <br />
with optionally some additional patches for ext3 or/and ReiserFS (see Patches  &mdash;&rarr; &hellip; in menuconfig) <br />
</p>
</blockquote>
<p>

</p>
<h3 id="SetupinFreetz">Setup in Freetz</h3>
<p>
There is currently (Freetz-trunk <a href="/changeset/11464">11464</a>) no web-interface available for NDAS. <br />
You can configure NDAS via console (e.g. via ssh or telnet access), but you can also use a script in rc.custom to get all configured for NDAS to work at startup. <br />
</p>
<h4 id="Manualconfigureviaconsole">Manual configure via console</h4>
<p>
Details can be found in the following two threads <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=241882"><span class="icon">​</span>http://www.ip-phone-forum.de/showthread.php?t=241882</a> and <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=149182"><span class="icon">​</span>http://www.ip-phone-forum.de/showthread.php?t=149182</a>
</p>
<p>
First create the needed character and block-devices using the mknod command. <br />
You can create block-devices for multiple drives and multiple partitions. Below example for one drive with one partition.
</p>
<pre class="wiki">mknod -m 644 /dev/ndas c 60 0
mknod -m 644 /dev/nda b 60 0
mknod -m 644 /dev/nda1 b 60 1
</pre><blockquote>
<p>
For additional partitions you can create the devices nodes with /dev/nda&lt;partition-number&gt; b 60 &lt;partition-number&gt;
</p>
</blockquote>
<p>
You can verify the creation of the devices with the following well known command
</p>
<pre class="wiki">ls -la /dev/nd*
</pre><blockquote>
<p>
The block-devices will start with a 'b', character-devices start will a 'c'.
</p>
</blockquote>
<p>
Next the kernel moduls needs to be loaded.
</p>
<pre class="wiki">insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_sal.ko
insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_core.ko ndas_dev=lan
insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_block.ko
</pre><blockquote>
<p>
The option ndas_dev=lan enables the module only for Eth and WiFi, and not for Wan interfaces. <br />
If you have your internal Ethernet switch configured as router (see <a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=243444"><span class="icon">​</span>here</a> for more background info in German), you will connect and access the NDAS device only via one of the routed Ethernet ports, and you can/should use ndas_dev=eth0 <br />
Be aware that the protocol used by the NDAS device is not routed, so only within the broadcast domain you can access the NDAS device. <br />
</p>
</blockquote>
<p>
To verify the three modules are loaded properly you can use the following command:
</p>
<pre class="wiki">lsmod
</pre><p>
Now the NDAS driver 'NDAS Administration Tool' should be started. This is done with:
</p>
<pre class="wiki">ndasadmin start
</pre><p>
Following is to register the netdisk with the ID and key, that should be found on the NDAS device.
</p>
<pre class="wiki">ndasadmin register "rrrrr-rrrrr-rrrrr-rrrrr-wwwww" --name ndas-01
</pre><blockquote>
<p>
The ID is the 'rrrrr-rrrrr-rrrrr-rrrrr' part which is 20 characters long, and is always needed.
The key is the 'wwwww' part which is 5 characters long and is optional to allow write access.
</p>
</blockquote>
<p>
If the disk is connected to the LAN network, and powered on the disk should become visible at this point. <br />
Verify the status via the proc filesystem /proc with the following commands.
</p>
<pre class="wiki">cat /proc/ndas/devs
</pre><blockquote>
<p>
To see the disk details and the status.
</p>
</blockquote>
<pre class="wiki">cat /proc/ndas/devices/ndas-01/slots
</pre><blockquote>
<p>
Shows the number of slots.
</p>
</blockquote>
<p>
The NetDisks can be enabled with one of the following three modes:
For read access use the following
</p>
<pre class="wiki">ndasadmin enable -s 1 -o r
</pre><p>
For read/write access the following can be used:
</p>
<pre class="wiki">ndasadmin enable -s 1 -o w
</pre><p>
For shared write access use:
</p>
<pre class="wiki">ndasadmin enable -s 1 -o s
</pre><p>
Also a mountpoint is needed that can be created with:
</p>
<pre class="wiki">mkdir /var/media/ndas/ntfs/
</pre><p>
As last step, mounting the block-device under the mountpoint just created.
The mount command depends on the formatting of the drive.
So far I had only success with an NTFS formatted drive.
</p>
<p>
Mount an NTFS formatted drive:
</p>
<pre class="wiki">ntfs-3g -o rw /dev/nda1 /var/media/ndas
</pre><p>
A FAT formatted drive should be mounted with:
</p>
<pre class="wiki">mount -t fat /dev/nda1 /var/media/ndas
</pre><p>
But I wasn't able to mount my FAT32 formatted drive, also tried -t vfat.
</p>
<h4 id="Scriptatstartup">Script at startup</h4>
<p>
You can use the script in file rc.custom, which can be edited via the <a href="mod.html#rc_custom">web-interface</a>.
</p>
<pre class="wiki">#! /bin/sh
# Create the character file to send the commands
test ! -c /dev/ndas &amp;&amp; mknod -m 644 /dev/ndas c 60 0
M=0
# Let's create the block device files to access the hard disk.
# Just for 3 hard disk, each with 3 partitions, but you can increase if you want.
for s in a b c;
do
    test ! -b /dev/nd${s} &amp;&amp; mknod -m 644 /dev/nd${s} b 60 $M
    for t in 1 2 3;
    do
        M=$(($M + 1))
        test ! -b /dev/nd${s}${t} &amp;&amp; mknod -m 644 /dev/nd${s}${t} b 60 $M
    done
    M=$(($M + 16 - $t))
done

# Now load the system abstraced layer implementation for NDAS technology
insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_sal.ko &gt; /dev/null 2&gt;&amp;1
if [ ! $? ] ; then
    echo " Module ndas_sal failed to load";
    exit 1;
fi
# Load the NDAS core functions, the proprietary driver.
insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_core.ko ndas_dev=lan &gt; /dev/null 2&gt;&amp;1
if [ ! $? ] ; then
    echo " Module ndas_core failed to load"
    exit 1;
fi
# Load the block device implementation for NDAS
insmod /lib/modules/`uname -r`/kernel/fs/ndas/ndas_block.ko &gt; /dev/null 2&gt;&amp;1
if [ ! $? ] ; then
    echo " Module ndas_block failed to load"
    exit 1;
fi
# Start the service
/usr/bin/ndasadmin start &gt; /dev/null 2&gt;&amp;1
if [ ! $? ]; then
    echo " ndasadmin start failed"
    exit 1;
fi

# Register the device
/usr/bin/ndasadmin register rrrrr-rrrrr-rrrrr-rrrrr-wwwww --name ndas-01 &gt; /dev/null 2&gt;&amp;1
sleep 5

# Enable connection with first NDAS blockdevice in exclusive-write mode
/usr/bin/ndasadmin enable -s 1 -o s
sleep 5
mkdir -p /var/media/ndas/usb /var/media/ndas/ntfs /var/media/ndas/fat /var/media/ndas/ext2
sleep 5
# mount ntfs NDAS disk, /dev/nda1 in this case, in read write mode
ntfs-3g -o rw /dev/nda1 /var/media/ndas/ntfs
# mount ext2 NDAS disk, /dev/nda2 in this case
mount /dev/nda2 /var/media/ndas/ext2

# Restart Samba with NetDisk mounted
/etc/init.d/rc.samba restart
# Restart NFS server with NetDisk mounted
/etc/init.d/rc.nfsd restart
</pre><h4 id="Troubleshooting">Troubleshooting</h4>
<p>
Here a list of troubleshooting commands.
</p>
<ol><li> ls -la /dev/nd* <br /> The output should give one character device /dev/ndas, per disk one block device starting with /dev/nda for the first disk, and for each partition another block device. <br /><br />
</li><li> lsmod <br /> The output should show the 3 modules loaded, which are <strong>ndas_sal</strong>, <strong>ndas_core</strong>, <strong>ndas_block</strong>. <br /><br />
</li><li> cat /proc/ndas/devs <br /> The output should give the NDASName choosen, the ID, an indication if the key is used for write access, serialnumber of the NetDisk, NDAS version which is 1, the status of the NetDisk, and the slot number that is assigned to the NetDisk. <br /><br />
</li><li> cat /proc/ndas/devices/ndas-01/slots <br /> The output should give the assigned slots number, which is <strong>1</strong> in my case. <br /><br />
</li><li> cat /proc/partitions <br /> The output should show a NDAS partition for each NetDisk, and one for each partition on that NetDisk (so at least two). <br /><br />
</li><li> ls -la /var/media/ndas <br /> The output should show the mountpoint, and if the NetDisk is mounted the content of the NetDisk. <br /><br />
</li><li> mount <br /> The output should show one line for each partition mounted. It will show the device node, the mountpoint, the filesystem type and the options used (e.g. read/write (rw) or read only (ro)) <br /><br />
</li><li> cat /etc/debug <br /> Behaves like a tail -f of a regular file where debug messages are shown to standard output.
</li></ol><h4 id="Troubleclearing">Troubleclearing</h4>
<p>
Some hints that could be helpful.
</p>
<ol><li>Unmount the NetDrive partition with <br /> <tt> umount /dev/nda&lt;partition-number&gt; </tt> <br /> If the umount fails verify if applications like Samba are stopped. <br /><br />
</li><li>Disable the NetDisk with <br /> <tt> ndasadmin disable -s 1 </tt> <br /><br />
</li><li>Stop the NDAS Driver with <br /> <tt> ndasadmin stop </tt> <br /> Be aware that after stopping the driver you also have to re-register the NetDrive. <br /><br />
</li><li>If the enable command indicates the NetDrive is in use by another entity, and you know it isn't, power off the NetDrive and try again. <br /><br />
</li><li>After powering off the NetDisk I had to do the following to get it working again:
<ul><li>Stop Samba or NFS (e.g. /etc/init.d/rc.samba stop, or /etc/init.d/rc.nfsd stop)
</li><li>Unmount the NetDisk (e.g. umount /dev/nda1)
</li><li>Disable the NDAS NetDisk (e.g. ndasadmin disable -s 1)
</li><li>Enable the NDAS NetDisk (e.g. ndasadmin enable -s 1 -o s)
</li><li>Mount the NetDisk again (e.g. ntfs-3g -o rw /dev/nda1 /var/media/ndas/ntfs)
</li><li>Start Samba or NFS again (e.g. /etc/init.d/rc.samba start, or /etc/init.d/rc.nfsd start)
</li></ul></li></ol><h3 id="Usages">Usages</h3>
<p>
I used to have Ndas toghether with Samba on my 7270v3, to play movies from the ntfs formated NetDrive, via a Win7 pc over HDMI to my TV.<br />
This is working well for movies upto 720p, 1080p (e.g. upto 8GB). I also tried a 1080p of about 25GB, but that didn't work out.<br />
Via monitoring using <a href="netsnmp.en.html">Net-SNMP</a> I found that it is the CPU resources on the 7270v3, which is the limiting factor.<br /><br />
Currently I'm using Ndas with NFS on my 7390, with ext3 formatted NetDrive, via a Win7 pc over HDMI to my TV.<br />
I found it possible to play a movie of about 25GB with 1080p, only the very high detailed fragments where causing issues.<br />
It is still the CPU resources on the 7390 causing a bottleneck.
</p>
</div>

      </div>

    </div>
    </div>
  </body>
</html>
