<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      help/howtos/development/developer_information/package_development_start – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../../../../TracGuide.html" />
        <link rel="alternate" href="package_development_start%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../developer_information.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="package_development_start..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="/wiki/help/howtos/development/developer_information/package_development_start.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../../../../help.html" title="Zeige help an">help</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../howtos.html" title="Zeige help/howtos an">howtos</a><span class="pathentry sep">/</span><a class="pathentry" href="../../development.html" title="Zeige help/howtos/development an">development</a><span class="pathentry sep">/</span><a class="pathentry" href="../developer_information.html" title="Zeige help/howtos/development/developer_information an">developer_information</a><span class="pathentry sep">/</span><a class="pathentry" href="package_development_start.html" title="Zeige help/howtos/development/developer_information/package_development_start an">package_development_start</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../developer_information.html">Aufwärts</a></li><li><a href="../../../../WikiStart.html">Startseite</a></li><li><a href="../../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="package_development_start%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/help/howtos/development/developer_information/package_development_start" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="Firststeps-Howtostartyourfirstfreetzpackage">First steps - How to start your first freetz package</h1>
<h2 id="Info">Info</h2>
<p>
In this howto you will find a number of examples for building packages, each with their own parameters.<br />
The first part will describe the build environment, and preparing the Toolchain.<br />
Than the <a class="wiki" href="package_development_start/example_1.html">first example package</a> is the <a class="ext-link" href="http://www.nocrew.org/software/httptunnel.html"><span class="icon">​</span>HTTP tunnel server</a>. This package is an easy to compile, and a good choice for your first freetz package. <em><a class="wiki" href="../../../../packages/httptunnel.html">Httptunnel</a></em> is already included in freetz nowadays.<br /><br />
</p>
<p>
The <a class="wiki" href="package_development_start/example_2.html">second example</a> will show the package <a class="ext-link" href="http://parchive.sourceforge.net/"><span class="icon">​</span>par2cmdline</a>. Par2cmdline doesn’t require much additional parameters, but does require a patch.
This package require a lot of CPU and memory resources so that makes this package less interesting for inclusion into Freetz.<br /><br />
</p>
<p>
The <a class="wiki" href="package_development_start/example_3.html">third example</a> is for package <a class="ext-link" href="http://nzbget.sourceforge.net/"><span class="icon">​</span>nzbget</a>. NZBget needs a few additional parameters, a small patch, and a library that is already part of Freetz. Also this package requires a lot of CPU and memory resources, and maybe only useful on the most powerful FritzBox models. 
</p>
<h2 id="BuildEnvironment">Build Environment</h2>
<p>
There are <a class="wiki" href="../../common/install.html">different platforms</a> which you may use to build your package, but usually all involve Linux in some way. 
Currently Freetz-Linux looks to be the most updated choice.
</p>
<p>
Just use the latest <a class="ext-link" href="http://sourceforge.net/projects/freetz-linux/files/?source=navbar"><span class="icon">​</span>freetz-linux</a> availble. I used:
</p>
<ul><li><a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=199449&amp;page=28"><span class="icon">​</span>freetz-linux 1.2.1</a> (with xz added with:  sudo apt-get install xz-utils) <br /> (from <a href="/changeset/11347">revision 11347</a> the following is needed: sudo apt-get install libacl1-dev libattr1-dev libcap-dev) <br /> (from revision ??? the following is also needed: sudo apt-get install imagemagick)
</li></ul><p>
Very helpful information on <em>make</em>-targets such as <em><a class="wiki" href="../../common/install/menuconfig.html">menuconfig</a></em>, <em>toolchain</em>, <em>precompiled</em>, <em>recover</em> etc. may be retrieved in the <a class="wiki" href="../../../howtos.html">HowTos</a> section of the Freetz wiki.
</p>
<h3 id="Toolchain">Toolchain</h3>
<p>
The toolchain is built automatically with "make" (see below).
</p>
<p>
If you want to have your toolchain ready at an earlier stage, you can create it now:<br />Go to your build environment and change to your freetz directory, usually <tt>~/freetz-trunk</tt>.
</p>
<p>
In make menuconfig, select your hardware type (e.g. 7170), and after setting the Level of user competence to Expert you can look around in 'Toolchain options', but no changes are normally needed.
</p>
<pre class="wiki">$ make menuconfig
       Level of user competence (Expert)  ---&gt;
       Hardware type (7170)  ---&gt;
       Firmware language (en - international)  ---&gt;
       Toolchain options  ---&gt;
                 No changes needed
</pre><p>
Then create your toolchain:
</p>
<pre class="wiki">$ make toolchain

(for older revisions:)
FINISHED: toolchain/kernel/ - glibc compiler for the kernel
          toolchain/target/ - uClibc compiler for the userspace
(for later revisions:)
FINISHED: new download toolchains can be found in dl/
</pre><p>
In order to build your new package manually (without integration in the freetz build system), you should see that your toolchain is also included in the search path.
</p>
<h2 id="FileStructure">File Structure</h2>
<p>
Below the file structure used in the build environment (cross-compile environment) e.g. Freetz-linux mentioned earlier.
</p>

<p>`--<font color="0000FF">make</font><br />
   `--<font color="0000FF">&lt;package&gt;</font><br />
     |-- Config.in<br />
     |-- external.in<br />
     |-- external.files<br />
     |-- external.services<br />
     |-- <font color="0000FF">files</font><br />
     |    `-- .language<br />
     |    `-- <font color="0000FF">root</font><br />
     |          `-- <font color="0000FF">etc</font><br />
     |           |    `-- <font color="0000FF">default.&lt;package&gt;</font><br />
     |           |     |   `--&lt;package&gt;.cfg<br />
     |           |     |   `--<font color="00FF00">&lt;package&gt;_conf</font><br />
     |           |     |   `--&lt;package&gt;.save<br />
     |           |     `-- <font color="0000FF">init.d</font><br />
     |           |          `--<font color="00FF00">rc.&lt;package&gt;</font><br />
     |                  `-- <font color="0000FF">usr</font><br />
     |                 `-- <font color="0000FF">lib</font><br />
     |                      `--<font color="0000FF">cgi-bin</font><br />
     |                          `--<font color="00FF00">&lt;package&gt;.cgi</font><br />
     |                          `--<font color="0000FF">&lt;package&gt;</font><br />
     `--<font color="0000FF">patches</font><br />
     |    `--&lt;numbered-patch_file_name&gt;.patch<br />
     `-- &lt;package&gt;.mk</p>
<p><font color="00FF00">Font Green = executable <br /> </font><font color="0000FF"> Font Blue = directory</font></p>
<p>
The following files are required for compiling the package, e.g. for entries in <tt>make menuconfig</tt> and cross-compile steps.<br />
The patches are optional, and only needed if the downloadable source needs some changes.<br />
</p>
<blockquote>
<p>
make/&lt;package&gt;/Config.in<br />
make/&lt;package&gt;/patches/*<br />
make/&lt;package&gt;/&lt;package&gt;.mk<br />
</p>
</blockquote>
<p>
The following group of files are applicable if you plan to build a web-interface.<br />
The <a class="wiki" href="package_development_start/&lt;package&gt;.cfg.html">&lt;package&gt;.cfg</a> contains the default configuration parameters.<br />
The <a class="wiki" href="package_development_start/&lt;package&gt;_conf.html">&lt;package&gt;_conf</a> is an optional script for generating a config file if the deamon (binary) needs it.<br />
The <a class="wiki" href="package_development_start/rc.&lt;package&gt;.html">rc.&lt;package&gt;</a> is  responsible to start/stop the deamon with the proper parameters, and having the package included in the menu of the web-interface.<br />
The <a class="wiki" href="package_development_start/&lt;package&gt;.cgi.html">&lt;package&gt;.cgi</a> is used to create the body of the web-interface, where you can find the more HTML like statements.<br />
The <a class="wiki" href="package_development_start/.language.html">.language</a> is used to translate the <a class="wiki" href="package_development_start/&lt;package&gt;.cgi.html">&lt;package&gt;.cgi</a> web-interface to the selected language.
The file should highlight the files with <tt>lang</tt> statements, to translate/select the target language.<br />
The directory <tt>usr/lib/cgi-bin/&lt;package&gt;/</tt> is used for optional extra cgi scripts.
</p>
<blockquote>
<p>
make/files/root/etc/default.&lt;package&gt;/<a class="wiki" href="package_development_start/&lt;package&gt;.cfg.html">&lt;package&gt;.cfg</a><br />
make/files/root/etc/default.&lt;package&gt;/<a class="wiki" href="package_development_start/&lt;package&gt;_conf.html">&lt;package&gt;_conf</a><br />
make/files/root/etc/default.&lt;package&gt;/&lt;package&gt;.save<br />
make/files/root/etc/init.d/<a class="wiki" href="package_development_start/rc.&lt;package&gt;.html">rc.&lt;package&gt;</a><br />
make/files/root/usr/lib/cgi-bin/<a class="wiki" href="package_development_start/&lt;package&gt;.cgi.html">&lt;package&gt;.cgi</a><br />
make/files/root/usr/lib/cgi-bin/&lt;package&gt;/*<br />
</p>
</blockquote>
<h2 id="ExamplesBinaryPackage">Examples Binary Package</h2>
<ul><li><a class="wiki" href="package_development_start/example_1.html">Example 1 - httptunnel</a>
</li><li><a class="wiki" href="package_development_start/example_2.html">Example 2 - par2cmdline</a>
</li><li><a class="wiki" href="package_development_start/example_3.html">Example 3 - NZBget</a>
</li></ul><h2 id="ConfigurationHandling">Configuration Handling</h2>
<p>
The configuration is saved in the non-volatile memory (tffs) via a character device <tt>/var/flash/freetz/</tt>.<br />
This is done by saving (writing) a tar file containing all config data to this character device.<br />
You can test this with:<br />
</p>
<blockquote>
<p>
<tt>cat /var/flash/freetz &gt; /var/tmp/config.tar</tt> <br />
<tt>tar tf /var/tmp/config.tar</tt> <br />
</p>
</blockquote>
<p>
Freetz has a number of tools for handling configuration data and ‘saving them to’ / ’reading them from’ tffs.<br />
The data from the character device is taken-from / saved-to <tt>/var/tmp/flash</tt>.<br />
<tt>/tmp</tt> is a symbolic-link (symlink) to <tt>/var/tmp</tt>, so this makes <tt>/tmp/flash/</tt> is the same as <tt>/var/tmp/flash</tt><br />
</p>
<blockquote>
<p>
<tt># ls -al /tmp</tt><br />
<tt>lrwxrwxrwx    1 root     root             7 Jan 12 01:56 /tmp -&gt; var/tmp</tt>
</p>
</blockquote>
<p>
<tt>/tmp/flash</tt> is the location where all configuration data is gathered. A look into this directory should let you recognize the files also seen with the previous <tt>tar tf</tt> command.<br />
The default configuration file (e.g. the file you need to create for the package) is located at <tt>/mod/etc/default.&lt;package&gt;/&lt;package&gt;.cfg</tt>.<br />
This is a static file containing a pre-defined value (can be empty) for each variable (config parameter) in the following format:<br />
</p>
<pre class="wiki">export &lt;PACKAGE&gt;_&lt;VARIABLE1&gt;=’&lt;value1&gt;’
export &lt;PACKAGE&gt;_&lt;VARIABLE2&gt;=’&lt;value2&gt;’
export &lt;PACKAGE&gt;_&lt;VARIABLE3&gt;=’&lt;value3&gt;’
.
.
.
export &lt; PACKAGE&gt;_&lt;VARIABLEn&gt;=’&lt;valuen&gt;’
</pre><p>
These are also the values that will be used if you revert back to the default parameters via the web-interface using the ‘default’ button.<br />
This config file is using Shell syntax which makes it possible to use the file as command lines.<br /><br />
After changes are made via the web-interface, and saved with the ‘Apply’ button they are written to <tt>/mod/etc/conf/&lt;package&gt;.cfg</tt><br />
This file contains all the variables, so some changed, others still default, depending on the changes made (so the actual config values).<br />
So the file <tt>/mod/etc/conf/&lt;package&gt;.cfg</tt> containing the actual values, and <tt>/mod/etc/default.&lt;package&gt;/&lt;package&gt;.cfg</tt> with the default values contain the same parameters, but not necessarily in the same order.<br />
Again using the Shell syntax and the variables can be exported using: <tt>. /mod/etc/conf/&lt;package&gt;.cfg</tt><br /><br />
To preserve space in the non-volatile memory (tffs) only the difference with the default parameters (/mod/etc/default.&lt;package&gt;/&lt;package&gt;.cfg) and the actual changed parameters (/mod/etc/conf/&lt;package&gt;.cfg) are saved to <tt>/tmp/flash</tt>. This can be seen from the ‘.diff’ extension e.g. <tt>/tmp/flash/&lt;package&gt;.diff</tt>.<br /><br />
The main package for controlling all package config is mod. Mod contains a number of tools for handling package config:
</p>
<table style="border:none; text-align:left" class="wiki"><tr><td style="border: none"><p>
modconf load &lt;package&gt;<br />
modconf save &lt;package&gt;<br />
modsave<br />
modsave flash
</p>
</td><td style="border: none"><p>
Create the data /mod/etc/conf/&lt;package&gt;.cfg from the default conf file /mod/etc/default.&lt;package&gt;/&lt;package&gt;.cfg and /tmp/flash/&lt;package&gt;.diff<br />
Create the data /tmp/flash/&lt;package&gt;.diff from the default conf file /mod/etc/default.&lt;package&gt;/&lt;package&gt;.cfg and /mod/etc/conf/&lt;package&gt;.cfg<br />
Initiate for each package 'modconf save' and saves the results located in ‘/tmp/flash’ to tffs (non-volatile memory)<br />
Saves the content of ‘/tmp/flash/’ to tffs (non-volatile memory)
</p>
</td></tr></table><ul><li><a class="wiki" href="package_development_start/example_config_handling.html">Examples explaining these commands</a>.
</li></ul><h2 id="ExamplesWeb-Interface">Examples Web-Interface</h2>
<ul><li><a class="wiki" href="package_development_start/webinterface_example_1.html">Example 1 - httptunnel</a>
</li></ul><h2 id="Troubleshooting">Trouble shooting</h2>
<ul><li>If you see during <tt>make</tt> or <tt>make menuconfig</tt> only dots appear you probably started creating a new package stucture, which is still unfinished.<br />Just remove the unfinshed directory.
</li></ul><ul><li>A failure like <em>checking whether the C compiler (mipsel-linux-gcc -O2 -Wall -fomit-frame-pointer ) works&hellip; no</em><br /><em>configure: error: installation or configuration problem: C compiler cannot create executables.</em> most likely point to a wrong PATH environment setting. <br />Use <tt>echo $PATH</tt> for trouble shooting.<br />This can be expected if you first manually compiled the package, and than add the package to Freetz and try to create an image, with the previous exports still present.<br />A reboot might be the savest option.   
</li></ul><h3 id="References">References</h3>
<ul><li><a href="../create_gui.html">/wiki/help/howtos/development/create_gui</a>
</li><li><a class="ext-link" href="http://www.ip-phone-forum.de/showthread.php?t=90425"><span class="icon">​</span>http://www.ip-phone-forum.de/showthread.php?t=90425</a>
</li></ul></div>
          
          <div class="trac-modifiedby">
            <span><a href="package_development_start%3Faction=diff&amp;version=64.html" title="Version 64 von RomMon">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2014-11-22T17%3A38%3A03Z&amp;precision=second" title="Siehe Journal am 22.11.2014 17:38:03">vor 3 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 22.11.2014 17:38:03</span>
          </div>
        
        
      </div><ul class="tags"><li class="header">Tags</li><li><a href="/tags/development" rel="tag">development</a> </li><li><a href="/tags/howto" rel="tag">howto</a> </li><li><a href="/tags/howtos" rel="tag">howtos</a> </li><li><a href="../../../../packages.html" rel="tag">packages</a> </li></ul>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="package_development_start%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value=""/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>