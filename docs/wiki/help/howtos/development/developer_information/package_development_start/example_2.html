<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      help/howtos/development/developer_information/package_development_start/example_2 – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="/search" />
        <link rel="help" href="../../../../../TracGuide.html" />
        <link rel="alternate" href="example_2%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../package_development_start.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="../../../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="/wiki"><img src="../../../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="https://www.google.com/search" method="get" onsubmit="; this.elements.namedItem('q').value = this.elements.namedItem('oq').value + ' site:freetz.github.io'">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="oq" size="18" value="" />
          <input type="hidden" name="q" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Anmelden</a></li><li><a href="/prefs">Einstellungen</a></li><li><a href="../../../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="/about">Über Trac</a></li><li><a href="/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="/register">Registrieren</a></li><li class="last"><a href="../../../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Journal</a></li><li><a href="/roadmap">Projektplan</a></li><li><a href="/browser">Quellen durchsehen</a></li><li><a href="/report">Tickets anzeigen</a></li><li><a href="/search">Suche</a></li><li><a href="/tags">Tags</a></li><li><a href="/downloads">Downloads</a></li><li class="last"><a href="/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="example_2..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="/wiki/help/howtos/development/developer_information/package_development_start/example_2.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="/wiki">Wiki:</a><a class="pathentry" href="../../../../../help.html" title="Zeige help an">help</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../../howtos.html" title="Zeige help/howtos an">howtos</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../development.html" title="Zeige help/howtos/development an">development</a><span class="pathentry sep">/</span><a class="pathentry" href="../../developer_information.html" title="Zeige help/howtos/development/developer_information an">developer_information</a><span class="pathentry sep">/</span><a class="pathentry" href="../package_development_start.html" title="Zeige help/howtos/development/developer_information/package_development_start an">package_development_start</a><span class="pathentry sep">/</span><a class="pathentry" href="example_2.html" title="Zeige help/howtos/development/developer_information/package_development_start/example_2 an">example_2</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../package_development_start.html">Aufwärts</a></li><li><a href="../../../../../WikiStart.html">Startseite</a></li><li><a href="../../../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="example_2%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="/notification/help/howtos/development/developer_information/package_development_start/example_2" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="Example2:par2cmdline">Example 2: par2cmdline</h1>
<p>
This second example is a cmdline program for creating and using PAR2 files to detect damage in data files and repair them if necessary.
</p>
<p>
More info about par2cmdline can be found <a class="ext-link" href="http://sourceforge.net/projects/parchive"><span class="icon">​</span>here</a>.
</p>
<p>
Be aware that while trying this package on my 7270v3 I got a “Segmentation fault”, but didn’t look further for a solution (using par2cmdline-0.1 might be an option).
</p>
<h2 id="Buildmanually">Build manually</h2>
<p>
The toolchain should be part of the search path. This is achieved with the PATH= export command below. <br />
You can look with <tt>echo $PATH</tt> what the current search path variable is.
</p>
<pre class="wiki">mkdir par2cmdline
cd par2cmdline
wget http://sourceforge.net/projects/parchive/files/par2cmdline/0.4/par2cmdline-0.4.tar.gz
tar xfvz par2cmdline-0.4.tar.gz
cd par2cmdline-0.4
wget http://sourceforge.net/p/parchive/bugs/_discuss/thread/e9911edb/b6aa/attachment/par2cmdline-0.4-gcc4.patch
patch -p0 &lt; par2cmdline-0.4-gcc4.patch
./configure --help
export CC="mipsel-linux-gcc"
export CXX="mipsel-linux-uclibc-g++-wrapper"
export PATH=/home/freetz/freetz-trunk/toolchain/target/bin/:$PATH
./configure \
--prefix=/usr \
--build=i686-pc-linux-gnu \
--host=mipsel-linux
make
ls -la par2 *
file par2 *
mipsel-linux-strip par2
ls -la par2 *
file par2 *
</pre><blockquote>
<p>
<sup>*</sup> Optional, to see the impact of stripping. The file command should also show the executable is a MIPS executable.
</p>
</blockquote>
<p>
Next you might want to see that "<tt>make clean</tt>" properly works for this package.
This will (should) remove all generated files during <tt>make</tt>. 
</p>
<pre class="wiki">cd ~/freetz-trunk/par2cmdline/par2cmdline-0.4/
make clean
</pre><p>
The Freetz environment makes use of "<tt>make clean</tt>" of each package to remove all generated files during compiling.<br />
So testing this with this manual created package should give an idea what happens giving a "<tt>make clean</tt>" within Freetz.
</p>
<h2 id="AddpackagetoFreetz">Add package to Freetz</h2>
<p>
In this example we will create the directory and file structure ourselves.
</p>
<p>
For each new package a directory under ~/freetz-trunk/make/ should be created with a minimum of two files:
</p>
<pre class="wiki">`--make
     `--&lt;package-name&gt;
           |-- Config.in 
            `-- &lt;package-name&gt;.mk
</pre><p>
Optional there are more directories and files in case e.g. patches are needed like with par2cmdline.
</p>
<p>
Lets create the directory structure and the two files for Par2cmdline:
</p>
<pre class="wiki">cd /home/freetz/freetz-trunk/
mkdir –p /home/freetz/freetz-trunk/make/par2cmdline/patches/
vi /home/freetz/freetz-trunk/make/par2cmdline/Config.in
</pre><pre class="wiki">config FREETZ_PACKAGE_PAR2CMDLINE
        bool "par2cmdline 0.4"
        default n
        help
                Cmdline program for creating and using PAR2 files to detect damage in data files and repair them if necessary.
</pre><p>
The indents should be replaced with tabs.
</p>
<p>
For the second file keep in mind that $(pkg) will have the value par2cmdline, and $(PKG) with be PAR2CMDLINE.
</p>
<p>
<tt>vi /home/freetz/freetz-trunk/make/par2cmdline/par2cmdline.mk</tt>
</p>
<pre class="wiki">$(call PKG_INIT_BIN, 0.4)
$(PKG)_SOURCE:=$(pkg)-$($(PKG)_VERSION).tar.gz
$(PKG)_SOURCE_MD5:=1551b63e57e3c232254dc62073b723a9
$(PKG)_SITE:=http://sourceforge.net/projects/parchive/files/$(pkg)/$($(PKG)_VERSION)/

$(PKG)_BINARY:=$($(PKG)_DIR)/par2
$(PKG)_TARGET_BINARY:=$($(PKG)_DEST_DIR)/usr/sbin/par2
$(PKG)_CATEGORY:=Unstable

$(PKG_SOURCE_DOWNLOAD)
$(PKG_UNPACKED)
$(PKG_CONFIGURED_CONFIGURE)

$($(PKG)_BINARY): $($(PKG)_DIR)/.configured
        $(SUBMAKE) -C $(PAR2CMDLINE_DIR) \
                CXX="$(TARGET_CXX)"

$($(PKG)_TARGET_BINARY): $($(PKG)_BINARY)
        $(INSTALL_BINARY_STRIP)

$(pkg):

$(pkg)-precompiled: $($(PKG)_TARGET_BINARY)

$(pkg)-clean:
        -$(SUBMAKE) -C $(PAR2CMDLINE_DIR) clean

$(pkg)-uninstall:
        $(RM) $(PAR2CMDLINE_TARGET_BINARY)

$(PKG_FINISH)
</pre><p>
The indents should be replaced with tabs.<br />
</p>
<pre class="wiki">wget http://sourceforge.net/p/parchive/bugs/_discuss/thread/e9911edb/b6aa/attachment/par2cmdline-0.4-gcc4.patch -O 100-gcc4.patch
mv 100-gcc4.patch make/par2cmdline/patches/
</pre><p>
Note: Also tried with parameter -P make/par2cmdline/patches , but this wasn't accepted with the wget command, so I had to move the patch to the correct location.<br /><br />
</p>
<p>
Explanation of the lines:
</p>
<pre class="wiki">$(call PKG_INIT_BIN, 0.4)
</pre><p>
From this line the package version is determined. In this case 0.4
<br /><br />
</p>
<pre class="wiki">$(PKG)_SOURCE:=$(pkg)-$($(PKG)_VERSION).tar.gz
</pre><p>
This variable translate to the source file name that will be downloaded and used further. Here it will be PAR2CMDLINE_SOURCE:=par2cmdline-0.4.tar.gz
<br /><br />
</p>
<pre class="wiki">$(PKG)_SOURCE_MD5:=1551b63e57e3c232254dc62073b723a9
</pre><p>
This is the md5 hash value to verify successful download. PAR2CMDLINE_SOURCE_MD5:=1551b63e57e3c232254dc62073b723a9
<br /><br />
</p>
<pre class="wiki">$(PKG)_SITE:=http://sourceforge.net/projects/parchive/files/$(pkg)/$($(PKG)_VERSION)/
</pre><p>
The download url. PAR2CMDLINE_SITE:= <a class="ext-link" href="http://sourceforge.net/projects/parchive/files/par2cmdline/0.4/"><span class="icon">​</span>http://sourceforge.net/projects/parchive/files/par2cmdline/0.4/</a>
<br /><br />
</p>
<pre class="wiki">$(PKG)_BINARY:=$($(PKG)_DIR)/par2
</pre><p>
The binary file as result of compiling the package. Here it will be PAR2CMDLINE_BINARY:= source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/par2<br />
(source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/ is where the source is unpacked before it is compiled) 
<br /><br />
</p>
<pre class="wiki">$(PKG)_TARGET_BINARY:=$($(PKG)_DEST_DIR)/usr/sbin/par2
</pre><p>
The location in the Freetz structure where the stripped binary will be saved.  PAR2CMDLINE_TARGET_BINARY:= packages/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/root/usr/sbin/par2
<br /><br />
</p>
<pre class="wiki">$(PKG)_CATEGORY:=Unstable
</pre><p>
This line determines where in the ‘menuconfig’ this package will be located. Without this line the package will be located in ‘package’.<br /> The following options are possible ‘Unstable’, ‘Web interfaces’, and ‘Debug helpers’. 
<br /><br />
</p>
<pre class="wiki">$(PKG_SOURCE_DOWNLOAD)
</pre><p>
This line triggers the download of the package. It will be downloaded to ./dl/par2cmdline-0.4.tar.gz
<br /><br />
</p>
<pre class="wiki">$(PKG_UNPACKED)
</pre><p>
This line not only unpack the download, but also applies any patches that are available in make/par2cmdline/patch/*
<br /><br />
</p>
<pre class="wiki">$(PKG_CONFIGURED_CONFIGURE)
</pre><p>
This will indicate that the ./configure step needs to be performed, and initiate the ./configure step.
<br /><br /><br />
</p>
<p>
The lines below have the structure of Makefiles:
</p>
<pre class="wiki">target: dependencies
[tab] system command
</pre><p>
<br /><br />
</p>
<pre class="wiki">$($(PKG)_BINARY): $($(PKG)_DIR)/.configured
        $(SUBMAKE) -C $(PAR2CMDLINE_DIR) \
                CXX="$(TARGET_CXX)"
</pre><p>
This will initiate make with the specified CXX compiler as parameter.
PAR2CMDLINE : source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/.configured
</p>
<blockquote>
<p>
make -j2 -C source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4 CXX="mipsel-linux-uclibc-g++-wrapper"
</p>
</blockquote>
<p>
<br /><br />
</p>
<pre class="wiki">$($(PKG)_TARGET_BINARY): $($(PKG)_BINARY)
        $(INSTALL_BINARY_STRIP)
</pre><p>
Will strip the binary file. This will remove any unnecessary data from the executable to make it smaller. Something that is preferred for embedded systems with small flash space.
packages/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/root/usr/sbin/par2 : source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/par2
<br /><br />
</p>
<pre class="wiki">$(pkg):
</pre><p>
par2cmdline:
<br /><br />
</p>
<pre class="wiki">$(pkg)-precompiled: $($(PKG)_TARGET_BINARY)
</pre><p>
par2cmdline-precompiled: packages/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/root/usr/sbin/par2
<br /><br />
</p>
<pre class="wiki">$(pkg)-clean:
        -$(SUBMAKE) -C $(PAR2CMDLINE_DIR) clean
</pre><p>
par2cmdline-clean:
</p>
<blockquote>
<p>
make -C source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4 clean
</p>
</blockquote>
<p>
<br /><br />
</p>
<pre class="wiki">$(pkg)-uninstall:
        $(RM) $(PAR2CMDLINE_TARGET_BINARY)
</pre><p>
par2cmdline-uninstall:
</p>
<blockquote>
<p>
rm -f packages/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/par2cmdline-0.4/root/usr/sbin/par2
</p>
</blockquote>
<p>
<br /><br />
</p>
<pre class="wiki">$(PKG_FINISH)
</pre><p>
Ends the make script. 
</p>
<h2 id="Createnewimagewithaddedpackage">Create new image with added package</h2>
<p>
Like normal with creating an image execute <tt>make menuconfig</tt> and select your router model and all options and packages to be included.<br />
First select two additional libraries that are needed for par2cmdline:<br /> <tt>Shared libraries  ---&gt; C++  ---&gt; [*] libstdc++ (libstdc++-6.0.x.so)</tt> <br /> and <br /><tt>Shared libraries  ---&gt; C++  ---&gt; [*] uClibc++ (libuClibc++-0.2.3.so)</tt>.<br />
It is also possible to automatically get this package selected using the files we created. This is something shown in example 3.<br />
The newly added package is located in: <tt>Packages  ---&gt; Unstable  ---&gt; [*] par2cmdline 0.4</tt>.
</p>
<h2 id="Testing">Testing</h2>
<p>
Lets see if "<tt>make clean</tt>" works as expected. This should bring the state back to like it was before the "<tt>make</tt>" command.
</p>
<pre class="wiki">cd ~/freetz-trunk/
make clean
</pre><h2 id="PreparingNewPackageforPublicIntegrationtoFreetzTrunk">Preparing New Package for Public Integration to Freetz Trunk</h2>
<p>
In order to create a file which displays the changes which would be needed in freetz to add your package, issue the following commands:
</p>
<pre class="wiki">svn add make/par2cmdline
svn diff ./make &gt; patchfile
</pre><p>
In our case "patchfile" may be called "par2cmdline". Please note that there is no need for an extension here. You may only need an extension (e.g. .txt) for uploading it in the IPPF, because else it would not be recognized as a valid file for upload.
</p>
<p>
In addition you could even create a ready (and compressed) package of the two files which you had edited above:
</p>
<pre class="wiki">tar cfz par2cmdline.tar.gz make/par2cmdline --exclude .svn
tar tfz par2cmdline.tar.gz
</pre></div>
          
          <div class="trac-modifiedby">
            <span><a href="example_2%3Faction=diff&amp;version=2.html" title="Version 2 von RomMon">zuletzt geändert</a> <a class="timeline" href="/timeline?from=2013-11-27T23%3A21%3A25Z&amp;precision=second" title="Siehe Journal am 27.11.2013 23:21:25">vor 4 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 27.11.2013 23:21:25</span>
          </div>
        
        
      </div>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="example_2%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value=""/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>