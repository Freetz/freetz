<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      help/howtos/development/developer_information/package_development_start/example_3 – Freetz
    </title>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script type="text/javascript">
      if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
    </script><![endif]-->
        <link rel="search" href="http://freetz.org/search" />
        <link rel="help" href="../../../../../TracGuide.html" />
        <link rel="alternate" href="example_3%3Fformat=txt" type="text/x-trac-wiki" title="Reiner Text" />
        <link rel="up" href="../package_development_start.html" title="Übergeordnete Wiki-Seite anzeigen" />
        <link rel="start" href="http://freetz.org/wiki" />
        <link rel="stylesheet" href="../../../../../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/phrases.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-300.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikiextras/css/boxes-narrow-toc.css" type="text/css" /><link rel="stylesheet" href="../../../../../../wikicss.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/tags/css/tractags.css" type="text/css" /><link rel="stylesheet" href="../../../../../../chrome/wikinegotiator/css/langmenu-ctxnav.css" type="text/css" />
        <link rel="shortcut icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="http://freetz.org/favicon.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="http://freetz.org/search/opensearch" title="Freetz durchsuchen" />
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/jquery.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/babel.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/messages/de.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/trac.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/search.js"></script>
      <script type="text/javascript" charset="utf-8" src="../../../../../../chrome/common/js/folding.js"></script>
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $("#content").find(".wikianchor").each(function() {
          $(this).addAnchor(babel.format(_("Link to #%(id)s"), {id: $(this).attr('id')}));
        });
        $(".foldable").enableFolding(true, true);
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://freetz.org/wiki"><img src="../../../../../../chrome/common/freetz_motd.png" alt="Freetz" /></a>
      </div>
      <form id="search" action="http://freetz.org/search" method="get">
        <div>
          <label for="proj-search">Suche:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Suche" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="http://freetz.org/login">Anmelden</a></li><li><a href="http://freetz.org/prefs">Einstellungen</a></li><li><a href="../../../../../TracGuide.html">Hilfe/Anleitung</a></li><li><a href="http://freetz.org/about">Über Trac</a></li><li><a href="http://freetz.org/notification" title="Wiki Pages Change Notifications">My Notifications</a></li><li><a href="http://freetz.org/register">Registrieren</a></li><li class="last"><a href="../../../../../Impressum.html">Impressum</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first active"><a href="http://freetz.org/wiki">Wiki</a></li><li><a href="http://freetz.org/timeline">Journal</a></li><li><a href="http://freetz.org/roadmap">Projektplan</a></li><li><a href="http://freetz.org/browser">Quellen durchsehen</a></li><li><a href="http://freetz.org/report">Tickets anzeigen</a></li><li><a href="http://freetz.org/search">Suche</a></li><li><a href="http://freetz.org/tags">Tags</a></li><li><a href="http://freetz.org/downloads">Downloads</a></li><li class="last"><a href="http://freetz.org/screenshots">Bildschirmfotos</a></li>
    </ul>
  </div>
    <div id="langmenu"><ul><li class="first"><span title="Select a language of wiki content">Language:</span></li><li class=" active"><a class="" href="example_3..html" title="displaying language (default)">German</a></li><li class=" last"><a class=" notexist" href="http://freetz.org/wiki/help/howtos/development/developer_information/package_development_start/example_3.en" title="(not available)">English</a></li></ul></div><div id="main">
      <div id="pagepath" class="noprint">
  <a class="pathentry first" title="Zeige WikiStart an" href="http://freetz.org/wiki">Wiki:</a><a class="pathentry" href="../../../../../help.html" title="Zeige help an">help</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../../howtos.html" title="Zeige help/howtos an">howtos</a><span class="pathentry sep">/</span><a class="pathentry" href="../../../development.html" title="Zeige help/howtos/development an">development</a><span class="pathentry sep">/</span><a class="pathentry" href="../../developer_information.html" title="Zeige help/howtos/development/developer_information an">developer_information</a><span class="pathentry sep">/</span><a class="pathentry" href="../package_development_start.html" title="Zeige help/howtos/development/developer_information/package_development_start an">package_development_start</a><span class="pathentry sep">/</span><a class="pathentry" href="example_3.html" title="Zeige help/howtos/development/developer_information/package_development_start/example_3 an">example_3</a>
</div>
      <div id="ctxtnav" class="nav">
        <h2>Kontext-Navigation</h2>
        <ul>
          <li class="first"><a href="../package_development_start.html">Aufwärts</a></li><li><a href="../../../../../WikiStart.html">Startseite</a></li><li><a href="../../../../../TitleIndex.html">Inhaltsverzeichnis</a></li><li><a href="example_3%3Faction=history.html">Änderungshistorie</a></li><li class="last"><a href="http://freetz.org/notification/help/howtos/development/developer_information/package_development_start/example_3" title="Watch Page">Watch Page</a></li>
        </ul>
        <hr />
      </div>
    <div id="content" class="wiki">
      <div class="wikipage searchable">
        
          <div id="wikipage" class="trac-content"><h1 id="Example3:NZBGet">Example 3: NZBGet</h1>
<p>
This third example is the package <a class="ext-link" href="http://nzbget.sourceforge.net/"><span class="icon">​</span>nzbget</a>.<br />
</p>
<p>
NZBget is for downloading from Usenet servers using nzb-files.<br />
This package requires the <a class="ext-link" href="http://www.xmlsoft.org"><span class="icon">​</span>libxml2</a> library which is already part of Freetz.
</p>
<p>
This package worked on my 7270v3, but didn't go as far as creating a config file and download something, just executed <tt>nzbget</tt> and <tt>nzbget -v</tt>.
</p>
<h2 id="Buildmanually">Build manually</h2>
<p>
During compile time of NZBget we need to have the library include files, and the compiled library available.
An option is to download the <a class="ext-link" href="ftp://xmlsoft.org/libxml2/libxml2-2.9.1.tar.gz"><span class="icon">​</span>libxml2 source files</a>, and first compile the library, but we can just as well let Freetz do that work for us.
</p>
<p>
Compile an image with at least libxml2 selected: 
</p>
<pre class="wiki">cd ~/freetz-trunk/
make menuconfig
Shared libraries  ---&gt; XML &amp; XSLT  ---&gt; [X] libxml2 (libxml2.so)
make
</pre><p>
Verify the library file and include files are available:
</p>
<pre class="wiki">ls /home/freetz/freetz-trunk/toolchain/target/include/libxml2/
ls -la /home/freetz/freetz-trunk/toolchain/target/lib/libxml2*
</pre><p>
The first ls should show the sub-directory <tt>libxml</tt>, and the second ls a number of lines with one being `libxml2.so.2.9.1' (or later), a a few symlinks pointing to this file.
</p>
<p>
Now lets manual compile this application.
</p>
<pre class="wiki">mkdir nzbget
cd ~/freetz-trunk-11230/nzbget/
wget http://sourceforge.net/projects/nzbget/files/nzbget-11.0.tar.gz
tar xfvz nzbget-11.0.tar.gz
cd nzbget-11.0
less README
export CC="mipsel-linux-gcc"
export CXX="mipsel-linux-uclibc-g++-wrapper"
export PATH=/home/freetz/freetz-trunk/toolchain/target/bin/:$PATH
export LIBS="-L~/freetz-trunk/libxml2/libxml2-2.9.1/builds/usr/lib/"
export CPPFLAGS="-I~/freetz-trunk/libxml2/libxml2-2.9.1/builds/usr/include/"
export libxml2_CFLAGS=/home/freetz/freetz-trunk/toolchain/target/include/libxml2/
export libxml2_LIBS=/home/freetz/freetz-trunk/toolchain/target/lib/

./configure \
--prefix=/usr \
--build=i686-pc-linux-gnu \
--host=mipsel-linux \
--with-libxml2-includes=/home/freetz/freetz-trunk/toolchain/target/include/libxml2/ \
--with-libxml2-libraries=/home/freetz/freetz-trunk/toolchain/target/lib/ \
--disable-curses \
--disable-parcheck \
--disable-tls \
--disable-gzip

vi ParCoordinator.cpp	
	add the following line somewhere between the existing include lines, e.g. somewhere above line 38 (but not between an if/endif):
	#include &lt;ctype.h&gt;
make

ls -la nzbget *
file nzbget *
mipsel-linux-strip nzbget
ls -la nzbget *
file nzbget *
</pre><blockquote>
<p>
<sup>*</sup> Optional, to see the impact of stripping. The file command should also show the executable is a MIPS executable.
</p>
</blockquote>
<p>
Next you might want to see that "<tt>make clean</tt>" properly works for this package.
This will remove all generated files. <br />(For packages involving a .config file you might want to save that file to a save location, because make clean often will also delete this file. But this is not applicable for nzbget.)
</p>
<pre class="wiki">cd ~/freetz-trunk/nzbget/nzbget-11.0/
make clean
</pre><p>
The Freetz environment makes use of "<tt>make clean</tt>" of each package to remove all generated files during compiling.<br />
So testing this with this manual created package should give an idea what happens giving a "<tt>make clean</tt>" within Freetz.
</p>
<h2 id="AddpackagetoFreetz">Add package to Freetz</h2>
<p>
In this example we will create the directory and file structure ourself.
</p>
<p>
For each new package a directory under ~/freetz-trunk/make/ should be created with a minimum of two files:
</p>
<pre class="wiki">`--make
     `--&lt;package-name&gt;
           |-- Config.in 
            `-- &lt;package-name&gt;.mk
</pre><p>
Optional there are more directories and files in case e.g. patches are needed.
</p>
<p>
Lets create the directory structure and the two files for NZBget:<br />
</p>
<pre class="wiki">cd /home/freetz/freetz-trunk/
mkdir -p ~/freetz-trunk/make/nzbget/patches/
vi ~/freetz-trunk/make/nzbget/Config.in
</pre><pre class="wiki">config FREETZ_PACKAGE_NZBGET
        bool "nzbget 11.0"
        select FREETZ_LIB_libxml2
        default n
        help
                NZBGet is a cross-platform binary newsgrabber for nzb files, written in C++. 
                It supports client/server mode, automatic par-check/-repair and web-interface. 
                NZBGet requires low system resources and runs great on routers, NAS-devices and media players.
</pre><p>
The indents should be replaced with tabs.
</p>
<p>
<tt>vi ~/freetz-trunk/make/nzbget/nzbget.mk</tt>
</p>
<pre class="wiki">$(call PKG_INIT_BIN, 11.0)
$(PKG)_SOURCE:=$(pkg)-$($(PKG)_VERSION).tar.gz
$(PKG)_SOURCE_MD5:=4f00039cc36e50fe68fc75e37b5a0406
$(PKG)_SITE:=http://sourceforge.net/projects/$(pkg)/files/

$(PKG)_BINARY:=$($(PKG)_DIR)/nzbget
$(PKG)_TARGET_BINARY:=$($(PKG)_DEST_DIR)/usr/bin/nzbget
$(PKG)_CATEGORY:=Unstable

$(PKG)_DEPENDS_ON += libxml2

$(PKG)_CONFIGURE_OPTIONS += --with-libxml2-includes=$(TARGET_TOOLCHAIN_STAGING_DIR)/include/libxml2/
$(PKG)_CONFIGURE_OPTIONS += --with-libxml2-libraries=$(TARGET_TOOLCHAIN_STAGING_DIR)/lib/
$(PKG)_CONFIGURE_OPTIONS += --disable-curses
$(PKG)_CONFIGURE_OPTIONS += --disable-parcheck
$(PKG)_CONFIGURE_OPTIONS += --disable-tls
$(PKG)_CONFIGURE_OPTIONS += --disable-gzip

$(PKG_SOURCE_DOWNLOAD)
$(PKG_UNPACKED)
$(PKG_CONFIGURED_CONFIGURE)

$($(PKG)_BINARY): $($(PKG)_DIR)/.configured
        $(SUBMAKE) -C $(NZBGET_DIR) \
                CXX="$(TARGET_CXX)"

$($(PKG)_TARGET_BINARY): $($(PKG)_BINARY)
        $(INSTALL_BINARY_STRIP)

$(pkg):

$(pkg)-precompiled: $($(PKG)_TARGET_BINARY)

$(pkg)-clean:
        -$(SUBMAKE) -C $(NZBGET_DIR) clean

$(pkg)-uninstall:
        $(RM) $(NZBGET_TARGET_BINARY)

$(PKG_FINISH)
</pre><p>
The indents should be replaced with tabs.
</p>
<p>
We also need to add a small patch file to add the one missing include.
</p>
<p>
<tt>vi make/nzbget/patches/100-ParCoordinator_ctype.h.patch</tt>
</p>
<pre class="wiki">diff -dur ParCoordinator.cpp.orig ParCoordinator.cpp
--- ParCoordinator.cpp.orig 2013-11-18 23:46:41.720138807 +0100
+++ ParCoordinator.cpp      2013-11-18 23:47:18.700129701 +0100
@@ -35,6 +35,7 @@
 #include &lt;string.h&gt;
 #include &lt;stdio.h&gt;
 #include &lt;stdarg.h&gt;
+#include &lt;ctype.h&gt;
 #ifdef WIN32
 #include &lt;direct.h&gt;
 #else
</pre><h2 id="Createnewimagewithaddedpackage">Create new image with added package</h2>
<p>
Like normal with creating an image execute <tt>make menuconfig</tt> and select your router model and all options and packages to be included.<br />
The newly added package is located in: <tt>Packages ---&gt; Unstable ---&gt; [*] nzbget 11.0</tt>.
Also select an additional library that is needed for nzbget:<br /><tt>Shared libraries  ---&gt; C++  ---&gt; [*] uClibc++ (libuClibc++-0.2.3.so)</tt>.<br />
</p>
<p>
If you manually created this package you might need a <tt>rm /home/freetz/freetz-trunk/source/target-mipsel_gcc-4.6.4_uClibc-0.9.32.1/config.cache</tt> or <tt>make distclean</tt>. And also be aware that the exports are still there, this can be easily solved with a reboot.
</p>
<p>
After exiting, create the package with <tt>make</tt>.
</p>
<h2 id="Testing">Testing</h2>
<p>
Lets see if "<tt>make clean</tt>" works as expected. This should bring the state back to like it was before the "<tt>make</tt>" command.
</p>
<pre class="wiki">cd ~/freetz-trunk/
make clean
</pre><h2 id="PreparingNewPackageforPublicIntegrationtoFreetzTrunk">Preparing New Package for Public Integration to Freetz Trunk</h2>
<p>
In order to create a file which displays the changes which would be needed in freetz to add your package, issue the following commands:
</p>
<pre class="wiki">svn add make/nzbget
svn diff ./make &gt; patchfile
</pre><p>
In our case "patchfile" may be called "nzbget". Please note that there is no need for an extension here. You may only need an extension (e.g. .txt) for uploading it in the IPPF, because else it would not be recognized as a valid file for upload.
</p>
<p>
In addition you could even create a ready (and compressed) package of the two files which you had edited above:
</p>
<pre class="wiki">tar cfz nzbget.tar.gz make/nzbget --exclude .svn
tar tfz nzbget.tar.gz
</pre></div>
          
          <div class="trac-modifiedby">
            <span><a href="example_3%3Faction=diff&amp;version=3.html" title="Version 3 von RomMon">zuletzt geändert</a> <a class="timeline" href="http://freetz.org/timeline?from=2013-11-29T00%3A06%3A42Z&amp;precision=second" title="Siehe Journal am 29.11.2013 00:06:42">vor 4 Jahren</a></span>
            <span class="trac-print">Zuletzt geändert am 29.11.2013 00:06:42</span>
          </div>
        
        
      </div><ul class="tags"><li class="header">Tags</li><li><a href="http://freetz.org/tags/development" rel="tag">development</a> </li><li><a href="http://freetz.org/tags/howto" rel="tag">howto</a> </li><li><a href="http://freetz.org/tags/howtos" rel="tag">howtos</a> </li><li><a href="../../../../../packages.html" rel="tag">packages</a> </li></ul>
      

    </div>
    <div id="altlinks">
      <h3>In anderen Formaten herunterladen:</h3>
      <ul>
        <li class="last first">
          <a rel="nofollow" href="example_3%3Fformat=txt">Reiner Text</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../../../../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Betrieben mit <a href="http://freetz.org/about"><strong>Trac 1.0.1</strong></a><br />
        von <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right"><div class="field" align="right"><form action="https://www.paypal.com/cgi-bin/webscr" method="post"><input type="hidden" name="cmd" value="_donations"/><input type="hidden" name="business" value="spenden@freetz.org"/><input type="hidden" name="item_name" value="Freetz Entwickler-Team"/><input type="hidden" name="no_shipping" value="1"/><input type="hidden" name="return" value="http://freetz.org"/><input type="hidden" name="cn" value="Name oder IPPF-Pseudonym"/><input type="hidden" name="currency_code" value="EUR"/><input type="hidden" name="tax" value="0"/><input type="hidden" name="lc" value="DE"/><input type="hidden" name="bn" value="PP-DonationsBF"/><input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="Zahlen Sie mit PayPal - schnell, kostenlos und sicher!"/><img alt="" border="0" src="http://freetz.org/pixel.gif" width="1" height="1"/></form></div></p>
    </div>
  </body>
</html>